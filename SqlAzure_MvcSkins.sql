/****** Object:  Table [dbo].[__MigrationHistory]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[__MigrationHistory](
	[MigrationId] [nvarchar](150) NOT NULL,
	[ContextKey] [nvarchar](300) NOT NULL,
	[Model] [varbinary](max) NOT NULL,
	[ProductVersion] [nvarchar](32) NOT NULL,
 CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY CLUSTERED 
(
	[MigrationId] ASC,
	[ContextKey] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[_DevSchemaVersions]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[_DevSchemaVersions](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ScriptName] [nvarchar](255) NOT NULL,
	[Applied] [datetime] NOT NULL,
 CONSTRAINT [PK__DevSchemaVersions] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[AspNetRoles]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetRoles](
	[Id] [nvarchar](128) NOT NULL,
	[Name] [nvarchar](256) NOT NULL,
 CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[AspNetUserClaims]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserClaims](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[UserId] [nvarchar](128) NOT NULL,
	[ClaimType] [nvarchar](max) NULL,
	[ClaimValue] [nvarchar](max) NULL,
 CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[AspNetUserLogins]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserLogins](
	[LoginProvider] [nvarchar](128) NOT NULL,
	[ProviderKey] [nvarchar](128) NOT NULL,
	[UserId] [nvarchar](128) NOT NULL,
 CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY CLUSTERED 
(
	[LoginProvider] ASC,
	[ProviderKey] ASC,
	[UserId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[AspNetUserRoles]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUserRoles](
	[UserId] [nvarchar](128) NOT NULL,
	[RoleId] [nvarchar](128) NOT NULL,
 CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY CLUSTERED 
(
	[UserId] ASC,
	[RoleId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[AspNetUsers]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[AspNetUsers](
	[Id] [nvarchar](128) NOT NULL,
	[Avatar] [nvarchar](max) NULL,
	[About] [nvarchar](max) NULL,
	[BirthDate] [datetime] NULL,
	[Location] [nvarchar](max) NULL,
	[DisplayName] [nvarchar](max) NULL,
	[UserRegistrationDate] [datetime] NULL,
	[PasswordResetGuid] [uniqueidentifier] NOT NULL,
	[PasswordResetExpireDate] [datetime] NULL,
	[WarningStart] [datetime] NULL,
	[WarningRead] [bit] NOT NULL,
	[SuspendedStart] [datetime] NULL,
	[SuspendedEnd] [datetime] NULL,
	[BannedStart] [datetime] NULL,
	[UserEmailPolicy] [int] NOT NULL,
	[IsActive] [bit] NULL CONSTRAINT [DF_AspNetUsers_IsActive]  DEFAULT ((1)),
	[Email] [nvarchar](256) NULL,
	[EmailConfirmed] [bit] NOT NULL,
	[PasswordHash] [nvarchar](max) NULL,
	[SecurityStamp] [nvarchar](max) NULL,
	[PhoneNumber] [nvarchar](max) NULL,
	[PhoneNumberConfirmed] [bit] NOT NULL,
	[TwoFactorEnabled] [bit] NOT NULL,
	[LockoutEndDateUtc] [datetime] NULL,
	[LockoutEnabled] [bit] NOT NULL,
	[AccessFailedCount] [int] NOT NULL,
	[UserName] [nvarchar](256) NOT NULL,
 CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Flags]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Flags](
	[FlagId] [int] IDENTITY(1,1) NOT NULL,
	[TopicId] [int] NOT NULL,
	[MessageId] [int] NULL,
	[Ip] [varchar](39) NOT NULL,
	[FlagDate] [datetime] NOT NULL,
 CONSTRAINT [PK_Flags] PRIMARY KEY CLUSTERED 
(
	[FlagId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Forums]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Forums](
	[ForumId] [int] IDENTITY(1,1) NOT NULL,
	[ForumName] [nvarchar](255) NOT NULL,
	[ForumShortName] [nvarchar](32) NOT NULL,
	[ForumDescription] [nvarchar](max) NOT NULL,
	[CategoryId] [int] NOT NULL,
	[ForumCreationDate] [datetime] NOT NULL,
	[ForumLastEditDate] [datetime] NOT NULL,
	[ForumLastEditUser] [uniqueidentifier] NULL,
	[Active] [bit] NOT NULL,
	[ForumTopicCount] [int] NOT NULL,
	[ForumMessageCount] [int] NOT NULL,
	[ForumOrder] [int] NOT NULL,
	[ReadAccessGroupId] [smallint] NULL,
	[PostAccessGroupId] [smallint] NOT NULL,
	[UserId] [uniqueidentifier] NULL,
 CONSTRAINT [PK_Forums] PRIMARY KEY CLUSTERED 
(
	[ForumId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[ForumsCategories]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ForumsCategories](
	[CategoryId] [int] IDENTITY(1,1) NOT NULL,
	[CategoryName] [nvarchar](255) NOT NULL,
	[CategoryOrder] [int] NOT NULL,
 CONSTRAINT [PK_ForumsCategories] PRIMARY KEY CLUSTERED 
(
	[CategoryId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[MessageRemovalReasons]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MessageRemovalReasons](
	[MessageRemovalReasonId] [int] IDENTITY(1,1) NOT NULL,
	[Title] [nvarchar](200) NOT NULL,
	[ReasonText] [nvarchar](200) NULL,
	[HideMessage] [bit] NOT NULL DEFAULT ((0)),
PRIMARY KEY CLUSTERED 
(
	[MessageRemovalReasonId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Messages]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Messages](
	[TopicId] [int] NOT NULL,
	[MessageId] [int] NOT NULL,
	[MessageBody] [nvarchar](max) NOT NULL,
	[MessageCreationDate] [datetime] NOT NULL,
	[MessageLastEditDate] [datetime] NOT NULL,
	[ParentId] [int] NULL,
	[Active] [bit] NOT NULL,
	[EditIp] [varchar](39) NULL,
	[MessageRemovalReasonId] [int] NULL,
	[UserId] [uniqueidentifier] NULL,
	[MessageLastEditUser] [uniqueidentifier] NULL,
 CONSTRAINT [PK_Messages] PRIMARY KEY CLUSTERED 
(
	[TopicId] ASC,
	[MessageId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[PageContents]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PageContents](
	[PageContentId] [int] IDENTITY(1,1) NOT NULL,
	[PageContentTitle] [nvarchar](128) NOT NULL,
	[PageContentBody] [nvarchar](max) NOT NULL,
	[PageContentShortName] [nvarchar](128) NOT NULL,
	[PageContentEditDate] [datetime] NOT NULL,
 CONSTRAINT [PK_PageContents] PRIMARY KEY CLUSTERED 
(
	[PageContentId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Settings]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Settings](
	[SettingKey] [varchar](256) NOT NULL,
	[SettingValue] [nvarchar](max) NULL,
	[SettingDate] [datetime] NOT NULL,
 CONSTRAINT [PK_Settings] PRIMARY KEY CLUSTERED 
(
	[SettingKey] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Tags]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Tags](
	[Tag] [nvarchar](50) NOT NULL,
	[TopicId] [int] NOT NULL,
 CONSTRAINT [PK_Tags] PRIMARY KEY CLUSTERED 
(
	[Tag] ASC,
	[TopicId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Templates]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Templates](
	[TemplateId] [int] IDENTITY(1,1) NOT NULL,
	[TemplateKey] [nvarchar](64) NOT NULL,
	[TemplateDescription] [nvarchar](256) NULL,
	[TemplateIsCurrent] [bit] NOT NULL,
	[TemplateDate] [datetime] NOT NULL,
 CONSTRAINT [PK_Templates] PRIMARY KEY CLUSTERED 
(
	[TemplateId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[Topics]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Topics](
	[TopicId] [int] IDENTITY(1,1) NOT NULL,
	[TopicTitle] [nvarchar](256) NOT NULL,
	[TopicShortName] [nvarchar](64) NOT NULL,
	[TopicDescription] [nvarchar](max) NOT NULL,
	[TopicCreationDate] [datetime] NOT NULL,
	[TopicLastEditDate] [datetime] NOT NULL,
	[TopicViews] [int] NOT NULL,
	[TopicReplies] [int] NOT NULL,
	[UserId] [uniqueidentifier] NOT NULL,
	[TopicTags] [nvarchar](256) NOT NULL,
	[ForumId] [int] NOT NULL,
	[TopicLastEditIp] [varchar](39) NOT NULL,
	[TopicLastEditUser] [uniqueidentifier] NULL,
	[Active] [bit] NOT NULL,
	[TopicIsClose] [bit] NOT NULL,
	[TopicOrder] [int] NULL,
	[LastMessageId] [int] NULL,
	[MessagesIdentity] [int] NOT NULL,
	[ReadAccessGroupId] [smallint] NULL,
	[PostAccessGroupId] [smallint] NOT NULL,
 CONSTRAINT [PK_Topics] PRIMARY KEY CLUSTERED 
(
	[TopicId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[TopicsSubscriptions]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[TopicsSubscriptions](
	[TopicId] [int] NOT NULL,
	[UserId] [uniqueidentifier] NOT NULL,
 CONSTRAINT [PK_TopicsSubscriptions_1] PRIMARY KEY CLUSTERED 
(
	[TopicId] ASC,
	[UserId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  Table [dbo].[UsersGroups]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[UsersGroups](
	[UserGroupId] [smallint] NOT NULL,
	[UserGroupName] [nvarchar](50) NOT NULL,
 CONSTRAINT [PK_UsersGroups] PRIMARY KEY CLUSTERED 
(
	[UserGroupId] ASC
)
) ON [PRIMARY]

GO
/****** Object:  UserDefinedFunction [dbo].[Split]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[Split] (@s nvarchar(512), @sep char(1))
RETURNS table
AS
RETURN (
    WITH Pieces(pn, start, stop) AS (
      SELECT 1, 1, CHARINDEX(@sep, @s)
      UNION ALL
      SELECT pn + 1, stop + 1, CHARINDEX(@sep, @s, stop + 1)
      FROM Pieces
      WHERE stop > 0
    )
    SELECT pn AS position,
      SUBSTRING(@s, start, CASE WHEN stop > 0 THEN stop-start ELSE 512 END) AS part
    FROM Pieces
  )
GO
/****** Object:  View [dbo].[MessagesComplete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO

CREATE view [dbo].[MessagesComplete]
As

Select  
	M.TopicId  
	,M.MessageId  
	,M.MessageBody  
	,M.MessageCreationDate  
	,M.MessageLastEditDate  
	,M.ParentId  
	,M.UserId  
	,M.Active  
	,U.UserName  
	,'' as "UserSignature"
	,0 as "UserGroupId"  
	,'' as UserGroupName  
	,U.Avatar  as "UserPhoto"
	,GETUTCDATE() as "UserRegistrationDate"
	,M.MessageRemovalReasonID
From  
dbo.Messages M  
	INNER JOIN dbo.AspNetUsers U ON U.Id = M.UserId  
	LEFT JOIN dbo.Messages P ON P.TopicId = M.TopicId AND P.MessageId = M.ParentId AND P.Active = 1

GO
/****** Object:  View [dbo].[TopicsComplete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO


CREATE VIEW [dbo].[TopicsComplete]   
AS  
SELECT  
	T.TopicId  
	,T.TopicTitle  
	,T.TopicShortName  
	,T.TopicDescription  
	,T.TopicCreationDate  
	,T.TopicViews  
	,T.TopicReplies  
	,T.UserId  
	,T.TopicTags  
	,T.TopicIsClose  
	,T.TopicOrder  
	,T.LastMessageId  
	,U.UserName
	,U.Avatar as "UserPhoto"
	,GETUTCDATE() as "UserRegistrationDate"
	,null as "UserSignature"
	,0 as "UserGroupId"
	,F.ForumId  
	,F.ForumName  
	,F.ForumShortName
	,CASE   
	WHEN ISNULL(T.ReadAccessGroupId, -1) >= ISNULL(F.ReadAccessGroupId, -1) THEN T.ReadAccessGroupId  
	ELSE F.ReadAccessGroupId END AS ReadAccessGroupId  
	,CASE   
	WHEN T.PostAccessGroupId >= ISNULL(F.ReadAccessGroupId,-1) THEN T.PostAccessGroupId -- Do not inherit post access  
	ELSE F.ReadAccessGroupId END AS PostAccessGroupId -- use the parent read access, if greater  
FROM  
	Topics T  
	INNER JOIN AspNetUsers U ON U.Id = T.UserId  
	INNER JOIN Forums F ON F.ForumId = T.ForumId  
WHERE  
	T.Active = 1  
	AND  
	F.Active = 1


GO
INSERT [dbo].[__MigrationHistory] ([MigrationId], [ContextKey], [Model], [ProductVersion]) VALUES (N'201410010006322_Init', N'HobbyClue.Web.Migrations.Configuration', 0x1F8B0800000000000400DD5CDB6EDCB6167D3F40FF41D0D3E9813BF2E524488D9904CED86E8C135F9071DAF3167024CE588844AA12E5D828FA657DE827F5174A4A9444F1A2CB8CE6E2224060939B6B6F6E6E929BD4A2FFFAE3CFF1BBA730B01E619CF8184DECA3D1A16D41E462CF47CB899D92C50F6FEC776FBFFBD7F8C20B9FAC9F0BB91326475BA264623F10129D3A4EE23EC01024A3D077639CE00519B9387480879DE3C3C31F9DA3230752089B6259D6F8538A881FC2EC17FAEB142317462405C135F66090F0725A33CB50AD1B10C224022E9CD81FF07CFE3C0D5238FA05CE47B9BC6D9D053EA0B6CC60B0B02D80102680504B4F3F277046628C96B3881680E0FE3982546E018204F21E9C56E25D3B7378CC3AE3540D0B28374D080E7B021E9D70EF3872F3957C6C97DEA3FEBBA07E26CFACD7990F27F69507B3A24F38A00E90159E4E8398094FECEB52C55912DD40322A1A8E72C8CB98C27DC3F1D791887860756E775046D3F1E890FD3BB0A66940D2184E104C490C8203EB2E9D07BEFB3FF87C8FBF423439399A2F4EDEBC7A0DBC93D7FF8527AFC49ED2BE52B95A012DBA8B7104636A1B5C94FDB72DA7DECE911B96CD8436B957682CD189615BD7E0E923444BF240A7CCF11BDBBAF49FA05794F0E0FA8C7C3A8F682312A7F4D79B3408C03C8065BDD3A893FDDFA0F5F8D5EB41B4DE80477F990DBDA49F4E9C98CEAB4F30C86A93073FCAA7576DBCBF70B1CB1887ECF77A7CE5B55F66388D5DD6196C14B907F11292BA7563A70ADE4E21CDA0860FEB0275FF439B59AA86B756947568959950A8D8F66C28ECDDACDECE1177164574F0B2D0621E690A38DD763592DA1F5835A92A7C8EBA860FA2DDFA27AF861F7008EFF137D4A099FED84973B3A2F77E4C1ECE0129D75EF6F3BD1FB636BC08811F0CB06077D042B3A5851F87B01C87F7984E0F807A7BF50E24095DAFBC0F2079D8B86767D04D633A8D660484D1C6B5DD3D60046FD270CE66E7F6740D3634F7DFF02570098E2F106BB536DE47EC7EC529B9401E0BE8CFC4ED1BDF25C020E69CB92E4C924B1ACCD09B627A182800AF103939EE0DC716D15D274CD300F8A13E639296FB2F85689535E92594CCC920A6CB9E9A4CFD88973EEA666A216A3635976835958BF535958175B3944B9A0DCD045AEDCCA506CB47B3111A3E21CD60F73F235D2FBD30AD05821B677485843F410463BA8C7977801018A36A04BAAC1BBB4867B2E1634A37BE37659A7E06413AB4AA956643B6080C3F1B32D8FD9F0D9999B4F8D1F75856D2E198560853F84EF2FA1360FB9C932CDBF674A87573DBCAB7B30698A6CB599260D7CF6681E6828E5FAFD4EDA7399CD57ED792F746BEAFA11DA381EEB32D8F96D0BED97250DDA273184002AD3337BFC09C82C4059EEA46DA21AF8761C58EAA31ACBAB7A91BF71F45278D7418B346801D82123A537D44D469E123D78F40D0EA25A965C72D8CF5BDD421D79CC30822A6B0D5135D94EBAF699801A51E6950DA3C347684886B0E4443D66A1AF3B614B61A77E5F6642B31D9923B1BE292E76F1B09CC668F6D21389B5DD2C500E395E32E02949F55BA06807C70D9B700954E4C8600E529D55602B4EEB11D0468DD252F2E40F3236AD7F197CEABFB169EF583F2F6B7F54677ED20366BFED8B3D0CC734FDA86D0163056C3F37CCE2AE113D11CCEA89DFC7C96F054570E11063E83A47E6553E5BBDA3CD469069183A809B00AB41650FEB152015226540FE38ABBBC46EB7816D103B6B8776B84E56BBF042BC4808A2D7EB41504CD9F76E5E0EC74FA287B56468312E49D0E0B028E2620E4C5ABDEF10E4E31DDCBAA8EE9920BF7C986858EF1C16870504BE66A7052D199C1BD548466BB977409599F946C2D2F49E993C14B456706F7128FD176276992821E69C15A2EAA6FE1034DB6E2A6A3DC6DCABAB193B3B978C1D831D0BEC6D7208A7CB4146860BCC49AE51CB0E90FB3FED4A830C770DC44C3902AAD2D35111C8325946AA96A6AE9A51F27E41C103007EC9E67EA858A98766F352CFF854A71FB5407B1D8070A69F673F1715C4331A8EDB66A3AC2512E691F4396D36417E99A08D037B718310F0420D6DCDD4F719086C89C62995BE75FF0C4F679898A307624FB95144AF19792E8D69DDF6968D46931D8309539CCEA4365863039BCC84045979BB252334A714925A2982EAE763674A664A6E770C99962FFD16A45D8CCDCAA0834224655DA1D4960C888504271772C4E9A117178514F0C8177A1800975DD51EBD41811B35ED31D51E2BF889052550F2B45964BCD48B162253C8347F512DD35A8BC16115DADED8EAC61B888D09AEA15B03536CB75DD51352418115853DD1DBB62C4C88BFB1EEFA9C653D51A9B6A7EF45E6F5735606C66A51E6653161806229050DC138B730814305EBE97F1643C7FAE114FF99DCB7AF164C030AF3EB5AFF3F5C5A7915260C6AC7D72AF2DF04D9403335EBFA8DD686C28075059A4D45E1E44A503E7981FFEDA1F2329A7C15CC4B60A37D2CDFD3921301C3181D1ECD7601AF8902DE585C03540FE022624A799D8C78747C7D26BA6FD7959E4248917680ECFA6E745F531DB02630C3D82D87D00B1CADF58E3F54D05AA5C8D5F210F3E4DECDFB256A7D92D0BFB292B3EB0AE92CFC8FF35A515F7710AADDF553EEA30AF119A0F807BFA76A4BB57AFFEFF256F7A60DDC674C69C5A87922F5719E1FA8B925ED6E44DD7B066E577262F7742C90F380AE07F87E0E97B116DA5471A1EFD996424F67E40B5471BDABE4AD374F5371A739F0CF23E632DC769DF60AC85A879673114DE202E34BDA35805CBF88662D5F0D3BFA958C534E37B0A1FF507935F53745F1C8B963BDC003567B56D2C94999F5BD9E86B515377BD632AA4F5B526BA4A4CEF01B706F97C85C87861BCEDC1F66C0D2D7B30EC5D86F6C6B9D8FB42BFAE8831BB655D6F9368DDF021ED1FC5AFDE0346A086E1B47B16F5B663CD74BFBCE754D47E5CE93D0B36CE7BDB3D237ADBC166BA7CDEF360EBC57BDEB358DBD5FEB9E348EBBC85EE9CC5AC12B20CDF897437D46D2CE5FC3A9F9EF0E79806419E51E68F4BF5B4B8264A6F8BC24AC4ACD4CCC793152B1347D1AB4834ABEDD757BEE1377696CB34AB35B0589B74F3F5BF51379769D66DE086EE825FAD6567EA38EF2DEB58136DEC25F1A96B3D69A1EFB7E5AC8D1FFD5F127D7A10A7D4668FE1CBF5CB614B0FE29221A74E0F76B4FA119AEE9DC2DFCDA4FB77E22F2B08F6573411746BBB6629738516B8D8BC258B0A11E986E61A12E0D12DF52C26FE02B88456B33BE6EC757C766FC7BE74CCA177856E5312A584761986F3A076E1C5928026FD1905BC6EF3F836CAFED0CB105DA066FAEC6EFE16BD4FFDC02BEDBED4DC0919205876C16F74D9581276B3BB7C2E916E30EA08C4DD572645F7308C020A96DCA2197884ABD846C3EF235C02F7B9BA013481B40F44DDEDE3731F2C6310261CA36A4F7FA531EC854F6FFF06275BB73A3E560000, N'6.1.0-30225')
GO
INSERT [dbo].[__MigrationHistory] ([MigrationId], [ContextKey], [Model], [ProductVersion]) VALUES (N'201410101614516_Init1', N'HobbyClue.Web.Migrations.Configuration', 0x1F8B0800000000000400DD5CDB6EE436127D5F20FF20E869B3705ABEEC0C668D76024FDBCE183BBE60DA93DDB7015B62B785912845A23C3616FB6579C827E517424A94C4AB2E2DF5C54180C04D164F158B45B2481DCE1FBFFD3EFDE9390CAC2798A47E84CEECA3C9A16D41E4469E8F56677686973FBCB37FFAF1BBBF4D2FBDF0D9FAA5943BA172A4254ACFEC478CE353C749DD4718827412FA6E12A5D1124FDC2874801739C78787FF728E8E1C48206C826559D34F19C27E08F31FE4E72C422E8C7106829BC88341CACA49CD3C47B56E4108D318B8F0CCFE102D162FB3208393FFC0C5A490B7ADF3C007C496390C96B605108A30C0C4D2D3CF299CE32442AB794C0A40F0F0124322B704410A590F4E6BF1AE9D393CA69D71EA8625949BA5380A7B021E9D30EF3872F3B57C6C57DE23FEBB247EC62FB4D7B90FCFEC6B0FE6459FA280384056783A0B122A7C66DF542ACED3F816E249D97052405E2504EE5B947C9DF0880756E7760755341D4F0EE97F07D62C0B7096C03304339C80E0C0BACF1681EFFE1BBE3C445F213A3B395A2C4FDEBD790BBC93B7FF84276FF89E92BE1239A18014DD27510C13621B5C56FDB72D476CE7C80DAB665C9BC22B2496C8C4B0AD1BF0FC11A2157E2453E6F89D6D5DF9CFD02B4B58707D463E9947A4114E32F2F3360B02B0086055EF34EAA4FF6FD07AFCE6ED285A6FC193BFCA875ED24F264E42E6D52718E4B5E9A31F17D34B18EF2F4CEC2A8942FA5B8CAFA2F6CB3CCA12977626328A3C806405B168DDD4A983B7534853A8F1C3BA44DDFFD0A696AAE1AD15A51D5A6726942AB63D1B4A7B37ABB773C49DC73119BC3CB4A8479A024EB75D4DA4F60796205587CF51D7F041A45B7FE5D5F04314C287E81B6AD04CFEECA4B959D17B3FC18F1700576B2FFDFBC10F5B1B7E8C5CB6656FD8C20B3F8D03F0D2B23F8CA3EB32047E30C22ED4410B4901977E12C22AB8DE4764CE03D43B54EE419A9245D8FB00D2C78D3B680EDD2C216BC31C8330DEB8B6FBC708C1DB2C5CD025677BBA461B9A876FD1157071945C22DA6A301E99735FA30C5F228FCED2CFD85D63D21600A39873EEBA304DAF4830436F1691134E09788DF0C9716F38BA33EC3A0B9C05C00FF569A0B4877D2945EB54502FA1A48306315D4AD864EAC768E5A36EA696A266530B89565399585F532958374B99A4D9D05CA0D5CE426AB4243B1FA1F1B3EC1C76FFD3EC613993692DE0DC38272B24FC1922989065CCBB0718C304D523D065DDD8458E960F1F55BAF1BD29D7F40B08B2B155AD351BF24560FCD990C3EEFF6CC8CD24C54FBE47B3920E67CF5298C07792D71F6BDBE79C64D9B6A783D0CD6D2BDFCE1A609A2EE7691AB97E3E0B34B78EECCE48B49FE47056FB0552D11BF9128A748C04BA4FB73C5242FA66CB4175872E600031B4CEDDE2567606521778AA1B4987BC1E86953BAAC6B0FA324A34EE1F8A4E12E930A18D003D04A564A6FA08ABD3C247AE1F83A0D54B52CB8E5B18ED7BA543AEB98031445461AB27BA28D7DF3D51032A3DD2A0B47968EA7011D71C8886ACD534E66D296C3DEECA95D05662B2257736C425CBDF361298CD1EDB427036BBA48B01C67BD45D04283BAB740D00F9E0B26F012A9D980C01CA52AAAD04A8E8B11D04A8E8925717A0C511B5EBF84BE7D57D0B4FF1A0BCFD6DBDD15D3B884DC11F7B169A45EE49DA60D202266A785E2C68257CC69AC319B1939DCF5296EACA2142C1E7108B573675BEABCD439D661039889A00EB406B01655F6015206542F530AEBCCB6BB48E65113D60CB7BB74658B6F64BB05C0CA8D8FC97684ED0FCBD5A0ECE4EA78FAA6755342841DEE9B0C0E16802425EBCC48E77708AE95E56754C975CB84F36CC758C0D4683835A32578393CACE8CEEA53234DBBDA44BC8FAA46483BC24A54F062F959D19DD4B2C46DB9DA4490A7AA405835C246EE1234DB6F2A6A3DA6DAABAA95350D458C1D43170D9A637208E7DB4E2B86DACC49A17C4B6D90FF3FE7CAFB0C070DC5443FBAAACAD34E128012B28D512D5C4D22B3F49F105C06001E83DCFCC0B1531EDDE6A58FE4B95FCF6A90E62B90F94D2F4EFF28BBF863721ECB66A3AC250AE481F439AD3E417E99A08D037B728DB100420D1DCDDCFA2200B9139C532B72EBEE0F1ED8B121561EA48F62B2994E22F25D1159DDF6968D46931DA305539CCFA4365863039BCCC4079979BB252334A7949C5A3982EAE763674A664A6E770C99962FFD16A45D8CCDCAA59413C465DDA1D89A3FDF0505C7177AC9A09C443D5A5DD9104AA0F0F265474C763741E1E8915F5C4E018210A1857D71D5524EDF098624D77448999C3434A553DACE4F93782917CC55A78068FEA25BA6B5019373CBA5ADB2BCA65EE8D14EE72F51AD81A9BE5BAEEA81A7A0E0FACA9EE8E5D7375E46D678F777BE3796FC0765F5C0A0CDBEF0D189BD943C6491738EE030FC415F7C462EC06058C95EF653C194FC603E2A9B80D1A164F060CF3EA23F006C4C5A791EC60C614C800C202DF448630E3F58BDA8DC686723496452AEDD511593A0A4FD9B1B4FDED97724E2D446CAB7423D9DC5F520CC3091598CC7F0D66810FE9525E0ADC00E42F618A0B028C7D7C78742C3D1EDB9F875C4E9A7A81E6586F7ACD258ED916B86CE80924EE23485466C980C74E35A872697F8D3CF87C66FF2F6F759ADFFFD0BFF2E203EB3AFD8CFC5F3352F19064D0FABFCA941DE7F147F3D1744F9FEA74F7EAF57FBF144D0FACBB84CC9853EB50F2E53A232C3EE0E9654DD17480356B3FEB79BD134A7E2F5302FF3D04CFDFF3686BBD89F1C8DF38A7D7F70392DFC80CB24AF30E66109EF0D6453B10D21AB2FED396858F4779D632A8BFDAA72B831035CF53C6C21BC585A6E727EB60199F9E0C981B9AA728EB98667C86E2A3FE60F22394EE2B77D97287BBB3E620B98D553CF7732B897F10A377D7DBB9C2F51F34D1553E7F0FB8019CFD3522E395D1DD474B28346CF6D1B07719DA1BA7B0EF0B6BBDE613ED96ACBE4D7E7AC3F7C7BF142D7D0F88941A62D8EEC9E7DB8E35D3E5F79E3378FB51CCF72CD8185D70F744F26D079BE9667CCF83AD175D7CCF626D57FBE78E23ADF316BA73F2B7CA63337CC4D25D9FB791BB8B6F0DE484BF884810141965F12657CF266C6242B728AC45CC4ACD344659B1327114BD8A44B3DA7E7D651B7E6367994CB35A03F9B749375BFF1B75339966DD064AED2E68E95A52ABEEA940CB3AD6C4B67B4D3474A1272DAF1EDA72D64646C26B629D8FE21461F6183EABBF1E92F9282E1973EAF42095AB5FC8C9DEC9FD1BAA64FF4EFD550D41FF4555045D61D7AC64AED1322A376FC9A25244BAA1B9811878644B3D4FB0BF042E26D5F48E39FF4705F27B3BFAA56301BD6B7497E138C3A4CB305C04C285174D029AF4E7CC79D1E6E95D4C7FA563748198E9D3BBF93BF43EF303AFB2FB4A73276480A0D905BBD1A56389E9CDEEEAA542BA8D504720E6BE2A297A80611C10B0F40ECDC1135CC736127E1FE10AB82FF50DA009A47D2044B74F2F7CB04A4098328CBA3DF94962D80B9F7FFC13C19C74394A580000, N'6.1.0-30225')
GO
INSERT [dbo].[__MigrationHistory] ([MigrationId], [ContextKey], [Model], [ProductVersion]) VALUES (N'201410182136596_Init2', N'HobbyClue.Web.Migrations.Configuration', 0x1F8B0800000000000400DD5CDB6EE4B8117D0F907F10F49404DE962F99C1C4E8DE85A76DEF1A195F30EDD9E46DC096D86D61244A2B515E1B41BE6C1FF693F20B21254AE2559796FAE2C500836EB278AA58AC228BD545FFEFB7DFA73FBC8481F50C93D48FD0CC3E991CDB16446EE4F9683DB333BCFAEE83FDC3F77FFED3F4CA0B5FAC9F4BBA334A4746A274663F611C9F3B4EEA3EC110A493D07793288D5678E246A103BCC8393D3EFE877372E2400261132CCB9A7ECE10F643987F215FE71172618C3310DC461E0C52D64E7A1639AA75074298C6C08533FBA768B97C9D07199CFC0B2E2705BD6D5D043E20B22C60B0B22D8050840126929E7F49E10227115A2F62D20082C7D71812BA150852C866705E93779DCCF1299D8C530F2CA1DC2CC551D813F0E48C69C791876FA463BBD21ED1DF15D1337EA5B3CE7538B36F3C98377D8E02A20099E1F93C4828F1CCBEAD585CA4F11DC49372E0A480BC4E08DCAF51F26DC2231E599DC71D55D6743A39A6FF8EAC7916E02C813304339C80E0C87AC89681EFFE13BE3E46DF209A9D9D2C57671FDEBD07DED9FBBFC3B377FC4CC95C099DD0409A1E92288609910DAEAAF9DB96238E73E481D5306E4CA115624BC4316CEB16BC7C82688D9F88CB9C7EB0AD6BFF057A650B33AE2FC8277E4406E124235FEFB22000CB0056FD4E234FFA7F03D7D377EF47E17A079EFD75BEF4127FE23809F1ABCF30C87BD3273F2EDC4B58EFAF8CEC3A8942FA5DB4AFA2F7EB22CA12974E2632923C82640DB128DDD4A98DB7934953A8F1CDBA443D7CD3A692AAE6AD25A513DAC4134A16BBF68652DEEDF2ED6C7117714C162F372DAA912683D31D571369FC912550D5E673D2D57C1099D61F7937BC780618240D7CC9C74E7C5BD82CA30C6F9DCB473FC14F970057FB3BFDFCE887AD033F452E0B0BB62CE1A59FC601786D3983C6E17515023F18E1A4EBC08584992B3F096165C01F23B2AF00D4DB1C1F409A928DDEFB09A44F5B57D002BA5942F69F050661BC756E0F4F11827759B884DB77378ED7684BF3F86B740D5C1C2557888E1A8C477CEE1BD914AE9047BDF40B763770DA026014712E5C17A6E9353166E8CD23728B2A016F103E3BED0D474F9F7D479AF300F8A13ED494CEC9AF25691D6EEA299490D340A60B3B9B44FD14AD7DD44DD492D42C6A41D12A2A23EB2B2A05EB2629A3340B9A13B4CA59508D16C8E72B347E249FC31E7E283F2C2E33ED059C1A176487843F420413B28D790F006398A07A05BAEC1BFB8803F3E5A34CB77E36E59C7E06413636AB8DBC21DF04C6F7861CF6F0BD211793343FFB1E8D4A3ADC6F4B6202DF895E7F756EF73949B25DBB8330CD5D33DFCD1E6072978B348D5C3FF7024D6693E5A544F9490C67B527A98AD9C8892E323162E83E3DF2480B999B2D1BD53DBA8401C4D0BA708BCCEF1CA42EF054359209793D042B4F548D6075C24B14EE6F0A4F62E930A18300BD04A5C4537D8455B7F091EBC72068D59234B2E31146E75EF1907B2E610C1165D8AA892ECCF5F92D2A40C5475A94360D4D1DCEE29A0DD110B59AD6BC2D84ADD75D493BEDC4265B6267835DB2F86D2B86D9ACB11D1867B34ABA0860CCD5EEC340D95DA5AB01C81797433350E9C66430501652EDC440458DEDC1404595BC39032DAEA85DD75FBAAF1E9A798A17E5DD1FEB8DEADA836D0AFA3830D32C624F320693113051CDF372493BE10BD65CCE889CEC7E96B2505736110ABE80584CD9D4F1AE360E759A4164236A02AC0DAD0594FDCAAB00290ED543B83297D7281D8B227AC09679B74658B6F74BB09C0DA8D8FCAFDD1CA1F93771D9383BDD3EAA9955D6A01879A7CB0287A3310879F31227DE4129A6BCACAA982EB1709F68989B185B8C0605B544AE06259593195D4BA569B66B491790F509C90669490A9F0C5A2A2733BA96988DB62B491314F4080B06A9483CC24772B632D3519D3655DFD429CAE058C3D431D4CB4D6F411CFB68CDD5CFB1166B5114CFCDBF5BF4AF290B0B0CC74D35A56595B415271C25600DA55EC29A487AED2729BE04182C01CDF3CCBD5021D39EAD86EDBF64C91F9FEA2296E740494D3F1723B4B519C269AB86230CE59ACC31A4314D9E48D758807EB8452B1A4100124DEE7E1E055988CC21967974F10B1E3FBE685111A68E24BF124229FA52025D51F99D9646758BD196A98A61365F2A338449E16504CAABDC14959A51CA24158F624A5CED6DE94CC14CCFE59223C5FEABD58AB01DDF2A2B8F7884B2AD074A51582480144DDD31B8B2211E876BEE8E555712F150756B7724A1548807133ABAE3B172201E8935F5C4E02A4A1430AEAF3BAA58F4C3638A3DDD11A5CA1E1E52EAEA21255FBF2308C9776C8467D0A89EA23B07B5628747577B7B59B95CBB2399BBDCBD01B64666B9AFC73EA196F7087B86DADD1DBBAEF5918FAD038E168CF7C501E142915418162F1830B673068D136E70B5133C10D7DC138B55472860ACFD20EDC978B31E604F453669983D1930CCBB8F5077206E3E8DC512664CA19840D8E09B8A29CC78FDAC76ABB6A15CAD65928A7B75C596AED25376AD6D7F9FA6DC730B12DB2AD5480EF7D714C3704209268B5F8279E043BA959704B700F92B98E2A280C63E3D3E39951EB81DCE6333274DBD40931630BD3813D76C07B570E81924EE138DD6E5CA94010FB26A5025E97F833CF832B3FF938F3ACFF347F453DE7C64DDA45F90FF4B463A1E930C5AFF552B6DC779A0D27CB53DD0E744DDB57AF3EFAFC5D023EB3E211E736E1D4BBADC6485C54746BDA429860E9066E3A7476FD7A1C4373D25EC5F42F0F2571EABF7BB9D4148CADB1C8F7CC679997F3F20F9ADCE20A934EF7106E1096F6EB40B2AED459B3FB159FA7894E73583E6AB7D42330851F34C662CBC5154687A06B30996F109CC00DFD03C89D94434E373181FF507931FC3743F01CA917B3CE53517D25D9C06B99E5B1F130CAA2CDE7758A0BC3918E4E8EABB821E7003DE0E6C60196FACEC7EB4C04453553F1AF63E4D7BEBA5F487523D5FD735EDB7687E9775F20DBF83FEA1CAE30FA0A05353A0B6FF22F85DDB9A29897EE095C4FD4ADD0FCCD858D9E2FE0BDA776D6CA60CFB811B5BAFB2F503B3B57D9D9F7BB6B4CE47E8DE8BD0D57A3AC38F61BA347C5B9179F19B05B9E12F236204454459BC0DD65735365564B730AC49CC4CCDE5943263C57114BE0A4533DB7E7365077EE364194D335B431172136FB6FF37F26634CDBC0DA5BDFB288FD716D7EA9E2CB4EC634D557F6FA91C5E9849CBEB8BB698B5B1B2E12D55BF8FA214C17B0C3FCFBF9D62F7515432A6EBF4286E577F69276727F7F762C9F99DFAEB1A82FEF558045DE1D4AC686ED02A2A0F6F49A29244CAD0DC420C3C72A45E24D85F0117936E9A63CEFFB8419EB7A3BF742CA17783EE331C67984C1986CB404878D120A0897F5EC12FCA3CBD8FE9B7748C2910317D9A9BBF471F333FF02AB9AF35392103048D2E584697AE25A699DDF56B857417A18E404C7D5550F408C3382060E93D5A8067B8896CC4FC3EC135705FEB0CA009A47D2144B54F2F7DB04E4098328C7A3CF94A6CD80B5FBEFF3F1200D68836590000, N'6.1.0-30225')
GO
INSERT [dbo].[__MigrationHistory] ([MigrationId], [ContextKey], [Model], [ProductVersion]) VALUES (N'201411130558267_Init', N'RunThemes.Web.Migrations.Configuration', 0x1F8B0800000000000400DD5C596F1BC9117E0F90FF30E0531268491DB1E108D42E644ADA08D10553B6F36634679A54C373ED4C8F2C21C82FCB437E52FE42AAE7629F73F3D0C28041F6F1557575557775B14AFFFBCF7FA7BFBC78AEF58CA39804FED9E8687C38B2B06F070EF15767A3842E7FFA30FAE5E73FFE617AE9782FD69762DC091B0733FDF86CF44469783A99C4F613F6503CF6881D0571B0A4633BF026C80926C787877F9B1C1D4D30408C00CBB2A69F129F120FA75FE0EB2CF06D1CD204B9B78183DD386F879E798A6ADD210FC721B2F1D9E8EB13A1F8062DB03BFE8A17E32F04FFC8268DAC73972060688EDDE5C842BE1F504481DDD3CF319ED328F057F3101A90FBF81A6218B7446E8CF3659CAE87375DD1E1315BD1643DB180B29398065E4BC0A3935C4413797A27418F4A1182102F41D8F495AD3A15E4D9E8DAC169D3A7C00501C8044F676EC4069F8D6E4B12E7717887E9B89838CE20AF2280FB1144DFC73CE281D578DE41A952C7E343F6EFC09A252E4D227CE6E38446C83DB01E92854BEC7FE0D7C7E03BF6CF4E8E16CB930FEFDE23E7E4FD5FF1C93B7EA5B05618273440D34314843802DEF0B25CFFC89A88F326F2C4721A3727930AE81258C7C8BA452F37D85FD127B09BE30F23EB8ABC60A768C995EBB34FC09860128D12F87A97B82E5AB8B8EC9F54D264FF57503D7EF77E10AA77E899ACD2AD97E883E14460579FB09BF6C64F24CCCC4BD8EF6FF9B0AB28F0D87751BFB2DE6FF320896CB698C038E411452B4C45EEA693B5F23652690635BC5A17A8FBAFDA8C5355BDB543D982BA58424162DBD650F0BB59BA8D35EE3C0C61F352D56212A95238E39D3596400E2CB8191FE17CC7311BB9D6A1A3A63AE4C3DA7ECF47E2F933A228AAA00B1F1BD1AD21B30812BA712A1F49449F2E102D0F79F6F99178B5136F023BF70D36CCE105894317BDD65C44C3D04A0F59BC223128365B5C17C13CA03886D3D7F984634C7F4D48A9A1D9E796CA26A05DBE8424C25D98FA8A221F443607C5A51DE77EC2A85CCAC7000E42E4B75ECD3C8943EC3BD8E9C44839FBD277DACEFD08876247B24C292E3D44DC87008EB9D762FAB54F4F8E5B4B20051AC0A16A40059E344B1279B8F7AE153AF877143F6DDC04E7D84E22B8E660ABBC70E3D41E9E021FDF25DE026FFE40E7680DB6358F3F822B64D320BAF4D9ACDE7870AA7F876B070C8C59C7676A77B816328041D839B76D1CC757A0CCD89905F062EF677CCC9277FDA099B98878FA178DE4897D2B86AE5F35FA11CACBC6304CF7BAA962F5265811BF19ABC55033ABD9885A56F3616D596560CD38CD479A194D07D4F2998D1AECBD98EED0F00FC61476FF5F8CFD3C7FD359C089710E2724FE15FB18DC3AEC3C204A71E4AF77A0C9B9B18B9746BA7D8CE8C6EFA694D217E4264393EA640DE92130BC35A4B0FB6F0D299BD0FC4C1CE6953408A3148301BED1787D84A6DEE624CEB66D0EC232B74D7C3B6780C95CCEE338B0496A059A007A1EFE14F9071FCEAA8F8566AB91E3A9B0305074C2AE3C6881B58D64A5BAF72FB08B29B6CEEDEC0786198A6DE4A8628405392D182B6E540D63EBB8AAC8DC5F149AA0E9386293107B04B1C73CF1A96A16C4B74988DC5A2949331B5E616CED250DB9E702A72F599FD64AA209717D18953150D29136A54E42D309A771D58A68F05A4D7B5EE7C2AEF75D896E6E45276B7C67835EE6FEDB4614B35A625B50CE6A913461C0F893C02E14347FAB345500F9E1B26F0A2ABD980C0A9ABB545B515051623B505051246F4E41B3276AD3FD97DEABFBA69EE24379FBD77AA5B876A09B823CF64C3533DF13E650988123553D2F16AC13BF50CDE30CF8CCDF6771EEEACA2AC2C0E7988A219BB5BFABF54327D520B2125501AE15AD06344F26508014836AC15C11CBABE42EF7225AC01671B74AD8FCEC9760391D50B1F9A40A6EA039F54256CE46AF8F7265A536284ADEE8B1C0E16814423EBCC48537108A292EAB0AA6892FDCC61BE616966F4685806A3C5783908AC50C2EA54235EBA5A473C8DAB864BDA424B94F0629158B195C4AB98ED60B49E314B4700B7A8948BCC20732B622D251DE3665DF7492A55CE60DD3892137737A8BC290F82B2E57336FB1E659A2E6ECA779FBD4452FC398D8B12683B1E4B6A4448308ADB0D40BA481D32B12C5F40251B4402CCE33733C6598F66E351CFF0549FEFA5437B1B8078AD1EC73FE3BBE310548B872559F2487BA82857ACCB149A3E91A35D04FB7580A2D7251A409E0CF0237F17CB39F659E9DFD8CC7CFCF5A5484E944E25FF1A314A129DEAEB8038DF647B58D61F7AAF466BAEF9719C224F5C217E5E56EF24FCD2845B88A473185B076B67F26B7A6CB9EC98E63FB2DAB45D88C9515A96E3C42D1D60225CB641340B2A6E6185C9E1A8FC33537C75AA7AEF150EBD6E648426E1A0F267434C7D3E79FC9D6A68E684E41939DC6C36BBA3B62F3B96A460AFCA0E674C464361E5CEC698D98A5B86900B38EE678729E1B0F29F775404DF3DFB498694F0BABE2B3E204BBE23BDAE9AF902A27ABAED0D91C37CF9AE3D1F2A696185CE29502C6F5B5D7F92C374EA7E8594F8B5D1613E0846D16BB5A70C9A7B9094CF21D9DF00C12D58F684E414D6CE3D1D5DE56A7BF9CE2265D037277076C0DCF725F8BFB53CD8213EE52B5BB9DC5AAD7D7BA756FFC314DCC6278873A0BC0F5F3A80D189B71D08671C8B93C231E886B6E89956712296079FB5E2A95310AD557A9B2F06B3FA5326098CF212151473C862AB38BCC9842F68D70D457651F99F1DAA9EE4615448945C9434AEA654C4A8A3D4DF338507DF1B01218CA868CAC428C70CDBFC6147B6336603CFFCD9DB904B343BD18708B7CB2C431CD32CE46C787871FA4C2E3FD29029EC4B1E36AE268A64A6071CFB6903CEA3FA3C87E62EF593995AB47A1EC1A54F995EC1ABCF497B3D1BFD259A769C0957D4A9B0FACEBF8B34F7E4BA0E3314AB0F56F35357D98C2C1EA08D09E96793697EAF53FBF65530FACFB082CE6D43A9464D96587C5E2CF56DC64537B70D3B924F4ED1A94586659C0FEC9432F7FE6B15A9752F64252CA251DF84CD3BA98764072F9642FAE342592BDF0AACA20BB2ED8581699A4271E494FA425613EC9B025925D19D6954CF6C4E24B2817840E543ED995295D3965572C4D7965572843B925F1DBCB4B28B6D41E4CD29DDABDB6B2CB76EAEA2A7BD9ADB676B217A2A63E7228BC414468AA7FEC8265AC7DEC71C66B6A21BBB066AC83EC6215721564734FA698B9436F55135DD9865793CAB9B68AAC5749C9AEDD5BA5D8AC97A1AB05652DE07A148D75D08C37566F359883AD29A71A0C7B97AABDF11AAA7D299B5A27B4EEB65A6A9B055215692FBFABBAA83DC8E4D76426EFBEFA69DBBA66FA4568CF4B48DAD538ED99B2E5F9EABBAF64DAB6B2997E29DA73656B55AFB467BAB6ABFB73C79AD6F80ADD79F5919A482D6FABBE3A26DB3B635D4CD69DFDF6062FFC45004A907994D91F85D0A7B35795E2D4105C0F311335E7D1CB8415C351E82A23AAC9B65B6B7EE1572E361F534DD6507D52453B3FFF2B69E763AA691B6A3A765117A5ADAAD0D5AAD59C635549DE6FA90E4A58494DD95D9DCF5A99A6F396CA9E06118A603D863493B753E534884886349D16554D6AC608DC9DDC1FA587FB3B26AB3504FB13F53EB6855BB31C73ED2F83E2F296382A8648119A5B4C910357EA7944C912D914BA598C39FDAB3669DC8EFDD2B1C0CEB57F9FD030A1B064EC2D5C21E0C59C802AFA69E996C8F3F43E64DFE22196006C12169BBFF73F26C4754ABEAF3431210304F32EF2882EDB4BF67B275EBD96487781DF1028175FE9143D622F74012CBEF7E7E81977E10DD4EF06AF90FDBA8E009A40EA374214FBF482A05584BC38C758CF87AFA0C38EF7F2F3FF0103A9AD069B610000, N'6.1.2-beta1-30916')
GO
SET IDENTITY_INSERT [dbo].[_DevSchemaVersions] ON 

GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (1, N'mssql.0001.create-tables-init.sql', CAST(N'2014-11-12 04:22:10.837' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (2, N'mssql.0002.create-functions-init.sql', CAST(N'2014-11-12 04:22:10.893' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (3, N'mssql.0003.create-views-init.sql', CAST(N'2014-11-12 04:22:10.963' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (4, N'mssql.0004.create-procedures-init.sql', CAST(N'2014-11-12 04:22:11.390' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (5, N'mssql.0005.inserts-usergroups.sql', CAST(N'2014-11-12 04:22:11.450' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (6, N'mssql.0006.insert-forumscategories.sql', CAST(N'2014-11-12 04:22:11.510' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (7, N'mssql.0007.devdata.init.sql', CAST(N'2014-11-12 04:22:11.637' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (8, N'mssql.0008.create-procs-flags-clear-list.sql', CAST(N'2014-11-12 04:22:11.700' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (9, N'mssql.0009.alter-messages-lastedituser.sql', CAST(N'2014-11-12 04:22:11.797' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (10, N'mssql.0010.create-pagecontents-objects.sql', CAST(N'2014-11-12 04:22:11.973' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (11, N'mssql.0011.insert-pagecontents.sql', CAST(N'2014-11-12 04:22:12.033' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (12, N'mssql.0012.alter-ixflags.sql', CAST(N'2014-11-12 04:22:12.123' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (13, N'mssql.0013.alter-users-add-password-columns.sql', CAST(N'2014-11-12 04:22:12.193' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (14, N'mssql.0014.create-passwordreset-objects.sql', CAST(N'2014-11-12 04:22:12.260' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (15, N'mssql.0015.insert-terms-pagecontents.sql', CAST(N'2014-11-12 04:22:12.337' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (16, N'mssql.0016.retrieve-by-passwordreset-guid-object.sql', CAST(N'2014-11-12 04:22:12.403' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (17, N'mssql.0017.alter-templates-key.sql', CAST(N'2014-11-12 04:22:12.460' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (18, N'mssql.0018.alter-proc-topicsgetbyforum.sql', CAST(N'2014-11-12 04:22:12.523' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (19, N'mssql.0019.alter-proc-topicsgetbyforumlatest.sql', CAST(N'2014-11-12 04:22:12.583' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (20, N'mssql.0020.alter-proc-topicsgetbyforumunanswered.sql', CAST(N'2014-11-12 04:22:12.647' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (21, N'mssql.0021.alter-proc-topicsgetbytag.sql', CAST(N'2014-11-12 04:22:12.710' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (22, N'mssql.0022.alter-view-messagescomplete.sql', CAST(N'2014-11-12 04:22:12.780' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (23, N'mssql.0023.alter-proc-messagesgetbytopic.sql', CAST(N'2014-11-12 04:22:12.840' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (24, N'mssql.0024.alter-proc-messagesgetbytopicfrom.sql', CAST(N'2014-11-12 04:22:12.900' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (25, N'mssql.0025.alter-proc-messagesgetbytopicupto.sql', CAST(N'2014-11-12 04:22:12.960' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (26, N'mssql.0026.alter-proc-templates-insert.sql', CAST(N'2014-11-12 04:22:13.020' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (27, N'mssql.0027.alter-proc-templates-insert-or-update.sql', CAST(N'2014-11-12 04:22:13.080' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (28, N'mssql.0028.alter-proc-topicsgetbyforumlatest.sql', CAST(N'2014-11-12 04:22:13.143' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (29, N'mssql.0029.create-index-ixtopicsforumidactive.sql', CAST(N'2014-11-12 04:22:13.240' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (30, N'mssql.0030.alter-all-tables-nvarchar.sql', CAST(N'2014-11-12 04:22:13.540' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (31, N'mssql.0031.alter-columns-ip-length.sql', CAST(N'2014-11-12 04:22:13.600' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (32, N'mssql.0032.alter-all-procs-nvarchar.sql', CAST(N'2014-11-12 04:22:14.290' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (33, N'mssql.0033.alter-table-forums-add-readwrite-access-columns.sql', CAST(N'2014-11-12 04:22:14.353' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (34, N'mssql.0034.alter-procs-forums-readwrite-access-columns.sql', CAST(N'2014-11-12 04:22:14.390' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (35, N'mssql.0035.alter-table-topics-add-readwrite-access-columns.sql', CAST(N'2014-11-12 04:22:14.430' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (36, N'mssql.0036.alter-procs-topics-select-readwrite-access-columns.sql', CAST(N'2014-11-12 04:22:14.477' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (37, N'mssql.0037.alter-procs-topics-manipulation-readwrite-access-columns.sql', CAST(N'2014-11-12 04:22:14.503' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (38, N'mssql.0038.alter-proc-topics-get-by-related.sql', CAST(N'2014-11-12 04:22:14.523' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (39, N'mssql.0039.alter-proc-topicssubscritions-get-by-topic.sql', CAST(N'2014-11-12 04:22:14.547' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (40, N'mssql.0040.create-proc-users-groups-get-all.sql', CAST(N'2014-11-12 04:22:14.570' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (41, N'mssql.0041.update-role-names.sql', CAST(N'2014-11-12 04:22:14.590' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (42, N'mssql.0042.alter-proc-topics-getlatest.sql', CAST(N'2014-11-12 04:22:14.610' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (43, N'mssql.0043.create-settings-objects.sql', CAST(N'2014-11-12 04:22:14.643' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (44, N'mssql.0044.alter-table-settings.sql', CAST(N'2014-11-12 04:22:14.663' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (45, N'mssql.0045.alter-table-users-columns-moderation.sql', CAST(N'2014-11-12 04:22:14.683' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (46, N'mssql.0046.create-proc-users-warn.sql', CAST(N'2014-11-12 04:22:14.707' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (47, N'mssql.0047.create-proc-users-ban.sql', CAST(N'2014-11-12 04:22:14.733' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (48, N'mssql.0048.create-proc-users-suspend.sql', CAST(N'2014-11-12 04:22:14.757' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (49, N'mssql.0049.create-proc-users-warn-dismiss.sql', CAST(N'2014-11-12 04:22:14.780' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (50, N'mssql.0050.alter-proc-users-get-by-provider.sql', CAST(N'2014-11-12 04:22:14.800' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (51, N'mssql.0051.alter-proc-users-get-by-password-reset-id.sql', CAST(N'2014-11-12 04:22:14.820' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (52, N'mssql.0052.alter-proc-users-insert-by-provider.sql', CAST(N'2014-11-12 04:22:14.843' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (53, N'mssql.0053.alter-proc-users-get.sql', CAST(N'2014-11-12 04:22:14.863' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (54, N'mssql.0054.create-procs-forums-categories.sql', CAST(N'2014-11-12 04:22:14.910' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (55, N'mssql.0055.alter-table-users-userproviderid.sql', CAST(N'2014-11-12 04:22:14.940' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (56, N'mssql.0056.alter-proc-forum-get-by-category.sql', CAST(N'2014-11-12 04:22:14.960' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (57, N'mssql.0057.alter-proc-forum-get-by-category.sql', CAST(N'2014-11-12 04:22:14.980' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (58, N'mssql.0058.alter-proc-topics-get.sql', CAST(N'2014-11-12 04:22:15.010' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (59, N'mssql.0059.alter-proc-flags-get-all.sql', CAST(N'2014-11-12 04:22:15.040' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (60, N'mssql.0060.alter-proc-topics-get-unanswered-paging.sql', CAST(N'2014-11-12 04:22:15.067' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (61, N'mssql.0061.create-proc-messages-get.sql', CAST(N'2014-11-12 04:22:15.093' AS DateTime))
GO
INSERT [dbo].[_DevSchemaVersions] ([Id], [ScriptName], [Applied]) VALUES (62, N'mssql.0062.message-removal-functionality.sql', CAST(N'2014-11-12 04:22:15.133' AS DateTime))
GO
SET IDENTITY_INSERT [dbo].[_DevSchemaVersions] OFF
GO
INSERT [dbo].[AspNetUsers] ([Id], [Avatar], [About], [BirthDate], [Location], [DisplayName], [UserRegistrationDate], [PasswordResetGuid], [PasswordResetExpireDate], [WarningStart], [WarningRead], [SuspendedStart], [SuspendedEnd], [BannedStart], [UserEmailPolicy], [IsActive], [Email], [EmailConfirmed], [PasswordHash], [SecurityStamp], [PhoneNumber], [PhoneNumberConfirmed], [TwoFactorEnabled], [LockoutEndDateUtc], [LockoutEnabled], [AccessFailedCount], [UserName]) VALUES (N'719410fa-f826-4394-8d6c-b1b0c6e96274', NULL, NULL, NULL, NULL, N'Jahmai OSullivan', NULL, N'00000000-0000-0000-0000-000000000000', NULL, NULL, 0, NULL, NULL, NULL, 0, NULL, N'jahmai.osullivan@gmail.com', 0, N'ADleWTV2zxPPCKhyInSnmRNxT1os+tsUOKCa22mbH8uY85ycXuGweDRODgiC2Ihcvg==', N'321b915d-11de-4e39-8752-9835da6d15cb', NULL, 0, 0, NULL, 0, 0, N'jahmai.osullivan@gmail.com')
GO
SET IDENTITY_INSERT [dbo].[Forums] ON 

GO
INSERT [dbo].[Forums] ([ForumId], [ForumName], [ForumShortName], [ForumDescription], [CategoryId], [ForumCreationDate], [ForumLastEditDate], [ForumLastEditUser], [Active], [ForumTopicCount], [ForumMessageCount], [ForumOrder], [ReadAccessGroupId], [PostAccessGroupId], [UserId]) VALUES (3, N'Support', N'support', N'Click the ask a question button to contact us.', 1, CAST(N'2014-11-12 22:07:38.263' AS DateTime), CAST(N'2014-11-13 20:02:20.703' AS DateTime), N'719410fa-f826-4394-8d6c-b1b0c6e96274', 1, 10, 3, 0, NULL, 1, NULL)
GO
SET IDENTITY_INSERT [dbo].[Forums] OFF
GO
SET IDENTITY_INSERT [dbo].[ForumsCategories] ON 

GO
INSERT [dbo].[ForumsCategories] ([CategoryId], [CategoryName], [CategoryOrder]) VALUES (1, N'General', 1)
GO
SET IDENTITY_INSERT [dbo].[ForumsCategories] OFF
GO
SET IDENTITY_INSERT [dbo].[MessageRemovalReasons] ON 

GO
INSERT [dbo].[MessageRemovalReasons] ([MessageRemovalReasonId], [Title], [ReasonText], [HideMessage]) VALUES (1, N'Inappropriate content', N'The message was removed by a forum moderator (Inappropriate)', 0)
GO
INSERT [dbo].[MessageRemovalReasons] ([MessageRemovalReasonId], [Title], [ReasonText], [HideMessage]) VALUES (2, N'Off topic', N'The message was removed by a forum moderator (Off topic)', 0)
GO
INSERT [dbo].[MessageRemovalReasons] ([MessageRemovalReasonId], [Title], [ReasonText], [HideMessage]) VALUES (3, N'Offensive content', N'The message was removed by a forum moderator (Offensive)', 0)
GO
INSERT [dbo].[MessageRemovalReasons] ([MessageRemovalReasonId], [Title], [ReasonText], [HideMessage]) VALUES (4, N'Spam - Hide from Users', NULL, 1)
GO
SET IDENTITY_INSERT [dbo].[MessageRemovalReasons] OFF
GO
INSERT [dbo].[Messages] ([TopicId], [MessageId], [MessageBody], [MessageCreationDate], [MessageLastEditDate], [ParentId], [Active], [EditIp], [MessageRemovalReasonId], [UserId], [MessageLastEditUser]) VALUES (11, 1, N'This is my reply boss', CAST(N'2014-11-13 08:37:16.000' AS DateTime), CAST(N'2014-11-13 08:37:16.000' AS DateTime), NULL, 1, N'::1', NULL, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'719410fa-f826-4394-8d6c-b1b0c6e96274')
GO
INSERT [dbo].[Messages] ([TopicId], [MessageId], [MessageBody], [MessageCreationDate], [MessageLastEditDate], [ParentId], [Active], [EditIp], [MessageRemovalReasonId], [UserId], [MessageLastEditUser]) VALUES (11, 2, N'And another reply', CAST(N'2014-11-13 08:37:30.830' AS DateTime), CAST(N'2014-11-13 08:37:30.830' AS DateTime), NULL, 1, N'::1', NULL, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'719410fa-f826-4394-8d6c-b1b0c6e96274')
GO
INSERT [dbo].[Messages] ([TopicId], [MessageId], [MessageBody], [MessageCreationDate], [MessageLastEditDate], [ParentId], [Active], [EditIp], [MessageRemovalReasonId], [UserId], [MessageLastEditUser]) VALUES (11, 3, N'Do replies still work', CAST(N'2014-11-13 20:32:24.957' AS DateTime), CAST(N'2014-11-13 20:32:24.957' AS DateTime), NULL, 1, N'::1', NULL, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'719410fa-f826-4394-8d6c-b1b0c6e96274')
GO
SET IDENTITY_INSERT [dbo].[PageContents] ON 

GO
INSERT [dbo].[PageContents] ([PageContentId], [PageContentTitle], [PageContentBody], [PageContentShortName], [PageContentEditDate]) VALUES (1, N'About', N'
	<p>This forum is powered by <a href="http://www.nearforums.com">Nearforums</a>, an open source forum engine.</p>
	<p>Nearforums is released under <a href="http://nearforums.codeplex.com/license" target="_blank">MIT License</a>, you can get the source at <a href="http://www.nearforums.com/source-code">www.nearforums.com/source-code</a>.</p>', N'about', CAST(N'2014-11-12 04:22:12.000' AS DateTime))
GO
INSERT [dbo].[PageContents] ([PageContentId], [PageContentTitle], [PageContentBody], [PageContentShortName], [PageContentEditDate]) VALUES (2, N'Terms and conditions', N'<h2>Legal Notices</h2>  <p>We, the Operators of this Website, provide it as a public service to our users.</p>  <p>Please carefully review the following basic rules that govern your use of the Website. Please note that your use of the Website constitutes your unconditional agreement to follow and be bound by these Terms and Conditions of Use. If you (the "User") do not agree to them, do not use the Website, provide any materials to the Website or download any materials from them.</p>  <p>The Operators reserve the right to update or modify these Terms and Conditions at any time without prior notice to User. Your use of the Website following any such change constitutes your unconditional agreement to follow and be bound by these Terms and Conditions as changed. For this reason, we encourage you to review these Terms and Conditions of Use whenever you use the Website.</p>  <p>These Terms and Conditions of Use apply to the use of the Website and do not extend to any linked third party sites. These Terms and Conditions and our<span>Privacy Policy</span>, which are hereby incorporated by reference, contain the entire agreement (the Agreement) between you and the Operators with respect to the Website. Any rights not expressly granted herein are reserved.</p>  <h2><span>Permitted and Prohibited Uses</span></h2>  <p>You may use the the Website for the sole purpose of sharing and exchanging ideas with other Users. You may not use the the Website to violate any applicable local, state, national, or international law, including without limitation any applicable laws relating to antitrust or other illegal trade or business practices, federal and state securities laws, regulations promulgated by the U.S. Securities and Exchange Commission, any rules of any national or other securities exchange, and any U.S. laws, rules, and regulations governing the export and re-export of commodities or technical data.</p>  <p>You may not upload or transmit any material that infringes or misappropriates any person''s copyright, patent, trademark, or trade secret, or disclose via the the Website any information the disclosure of which would constitute a violation of any confidentiality obligations you may have.</p>  <p>You may not upload any viruses, worms, Trojan horses, or other forms of harmful computer code, nor subject the Website''s network or servers to unreasonable traffic loads, or otherwise engage in conduct deemed disruptive to the ordinary operation of the Website.</p>  <p>You are strictly prohibited from communicating on or through the Website any unlawful, harmful, offensive, threatening, abusive, libelous, harassing, defamatory, vulgar, obscene, profane, hateful, fraudulent, sexually explicit, racially, ethnically, or otherwise objectionable material of any sort, including, but not limited to, any material that encourages conduct that would constitute a criminal offense, give rise to civil liability, or otherwise violate any applicable local, state, national, or international law.</p>  <p>You are expressly prohibited from compiling and using other Users'' personal information, including addresses, telephone numbers, fax numbers, email addresses or other contact information that may appear on the Website, for the purpose of creating or compiling marketing and/or mailing lists and from sending other Users unsolicited marketing materials, whether by facsimile, email, or other technological means.</p>  <p>You also are expressly prohibited from distributing Users'' personal information to third-party parties for marketing purposes. The Operators shall deem the compiling of marketing and mailing lists using Users'' personal information, the sending of unsolicited marketing materials to Users, or the distribution of Users'' personal information to third parties for marketing purposes as a material breach of these Terms and Conditions of Use, and the Operators reserve the right to terminate or suspend your access to and use of the Website and to suspend or revoke your membership in the consortium without refund of any membership dues paid.</p>  <p>The Operators note that unauthorized use of Users'' personal information in connection with unsolicited marketing correspondence also may constitute violations of various state and federal anti-spam statutes. The Operators reserve the right to report the abuse of Users'' personal information to the appropriate law enforcement and government authorities, and the Operators will fully cooperate with any authorities investigating violations of these laws.</p>  <h2><span>User Submissions</span></h2>  <p>The Operators do not want to receive confidential or proprietary information from you through the Website. Any material, information, or other communication you transmit or post ("Contributions") to the Website will be considered non-confidential.</p>  <p>All contributions to this site are licensed by you under the MIT License to anyone who wishes to use them, including the Operators.</p>  <p>If you work for a company or at a University, it''s likely that you''re not the copyright holder of anything you make, even in your free time. Before making contributions to this site, get written permission from your employer.</p>  <h2><span>User Discussion Lists and Forums</span></h2>  <p>The Operators may, but are not obligated to, monitor or review any areas on the Website where users transmit or post communications or communicate solely with each other, including but not limited to user forums and email lists, and the content of any such communications. The Operators, however, will have no liability related to the content of any such communications, whether or not arising under the laws of copyright, libel, privacy, obscenity, or otherwise. The Operators may edit or remove content on the the Website at their discretion at any time.</p>  <h2><span>Use of Personally Identifiable Information</span></h2>  <p>Information submitted to the Website is governed according to the Operatorss current<span>Privacy Policy</span> and the stated license of this website.</p>  <p>You agree to provide true, accurate, current, and complete information when registering with the Website. It is your responsibility to maintain and promptly update this account information to keep it true, accurate, current, and complete. If you provides any information that is fraudulent, untrue, inaccurate, incomplete, or not current, or we have reasonable grounds to suspect that such information is fraudulent, untrue, inaccurate, incomplete, or not current, we reserve the right to suspend or terminate your account without notice and to refuse any and all current and future use of the Website.</p>  <p>Although sections of the Website may be viewed simply by visiting the Website, in order to access some Content and/or additional features offered at the Website, you may need to sign on as a guest or register as a member. If you create an account on the Website, you may be asked to supply your name, address, a User ID and password. You are responsible for maintaining the confidentiality of the password and account and are fully responsible for all activities that occur in connection with your password or account. You agree to immediately notify us of any unauthorized use of either your password or account or any other breach of security. You further agree that you will not permit others, including those whose accounts have been terminated, to access the Website using your account or User ID. You grant the Operators and all other persons or entities involved in the operation of the Website the right to transmit, monitor, retrieve, store, and use your information in connection with the operation of the Website and in the provision of services to you. The Operators cannot and do not assume any responsibility or liability for any information you submit, or your or third parties use or misuse of information transmitted or received using website. To learn more about how we protect the privacy of the personal information in your account, please visit our<span>Privacy Policy</span>.</p>  <h2><span>Indemnification</span></h2>  <p>You agree to defend, indemnify and hold harmless the Operators, agents, vendors or suppliers from and against any and all claims, damages, costs and expenses, including reasonable attorneys'' fees, arising from or related to your use or misuse of the Website, including, without limitation, your violation of these Terms and Conditions, the infringement by you, or any other subscriber or user of your account, of any intellectual property right or other right of any person or entity.</p>  <h2><span>Termination</span></h2>  <p>These Terms and Conditions of Use are effective until terminated by either party. If you no longer agree to be bound by these Terms and Conditions, you must cease use of the Website. If you are dissatisfied with the Website, their content, or any of these terms, conditions, and policies, your sole legal remedy is to discontinue using the Website. The Operators reserve the right to terminate or suspend your access to and use of the Website, or parts of the Website, without notice, if we believe, in our sole discretion, that such use (i) is in violation of any applicable law; (ii) is harmful to our interests or the interests, including intellectual property or other rights, of another person or entity; or (iii) where the Operators have reason to believe that you are in violation of these Terms and Conditions of Use.</p>  <h2><span>WARRANTY DISCLAIMER</span></h2>  <p>THE WEBSITE AND ASSOCIATED MATERIALS ARE PROVIDED ON AN "AS IS" AND "AS AVAILABLE" BASIS. TO THE FULL EXTENT PERMISSIBLE BY APPLICABLE LAW, THE OPERATORS DISCLAIM ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING, BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENTOF INTELLECTUAL PROPERTY. THE OPERATORS MAKE NO REPRESENTATIONS OR WARRANTY THAT THE WEBSITE WILL MEET YOUR REQUIREMENTS, OR THAT YOUR USE OF THE WEBSITE WILL BE UNINTERRUPTED, TIMELY, SECURE, OR ERROR FREE; NOR DO THE OPERATORS MAKE ANY REPRESENTATION OR WARRANTY AS TO THE RESULTS THAT MAY BE OBTAINED FROM THE USE OF THE WEBSITE. THE OPERATORS MAKE NO REPRESENTATIONS OR WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED, AS TO THE OPERATION OF THE WEBSITE OR THE INFORMATION, CONTENT, MATERIALS, OR PRODUCTS INCLUDED ON THE WEBSITE.</p>  <p>IN NO EVENT SHALL THE OPERATORS OR ANY OF THEIR AGENTS, VENDORS OR SUPPLIERS BE LIABLE FOR ANY DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOSS OF PROFITS, BUSINESS INTERRUPTION, LOSS OF INFORMATION) ARISING OUT OF THE USE, MISUSE OF OR INABILITY TO USE THE WEBSITE, EVEN IF THE OPERATORS HAVE BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. THIS DISCLAIMER CONSTITUTES AN ESSENTIAL PART OF THIS AGREEMENT. BECAUSE SOME JURISDICTIONS PROHIBIT THE EXCLUSION OR LIMITATION OF LIABILITY FOR CONSEQUENTIAL OR INCIDENTAL DAMAGES, THE ABOVE LIMITATION MAY NOT APPLY TO YOU.</p>  <p>YOU UNDERSTAND AND AGREE THAT ANY CONTENT DOWNLOADED OR OTHERWISE OBTAINED THROUGH THE USE OF THE WEBSITE IS AT YOUR OWN DISCRETION AND RISK AND THAT YOU WILL BE SOLELY RESPONSIBLE FOR ANY DAMAGE TO YOUR COMPUTER SYSTEM OR LOSS OF DATA OR BUSINESS INTERRUPTION THAT RESULTS FROM THE DOWNLOAD OF CONTENT. THE OPERATORS SHALL NOT BE RESPONSIBLE FOR ANY LOSS OR DAMAGE CAUSED, OR ALLEGED TO HAVE BEEN CAUSED, DIRECTLY OR INDIRECTLY, BY THE INFORMATION OR IDEAS CONTAINED, SUGGESTED OR REFERENCED IN OR APPEARING ON THE WEBSITE. YOUR PARTICIPATION IN THE WEBSITE IS SOLELY AT YOUR OWN RISK. NO ADVICE OR INFORMATION, WHETHER ORAL OR WRITTEN, OBTAINED BY YOU FROM THE OPERATORS OR THROUGH THE OPERATORS, THEIR EMPLOYEES, OR THIRD PARTIES SHALL CREATE ANY WARRANTY NOT EXPRESSLY MADE HEREIN. YOU ACKNOWLEDGE, BY YOUR USE OF THE THE WEBSITE, THAT YOUR USE OF THE WEBSITE IS AT YOUR SOLE RISK.</p>  <p>LIABILITY LIMITATION. UNDER NO CIRCUMSTANCES AND UNDER NO LEGAL OR EQUITABLE THEORY, WHETHER IN TORT, CONTRACT, NEGLIGENCE, STRICT LIABILITY OR OTHERWISE, SHALL THE OPERATORS OR ANY OF THEIR AGENTS, VENDORS OR SUPPLIERS BE LIABLE TO USER OR TO ANY OTHER PERSON FOR ANY INDIRECT, SPECIAL, INCIDENTAL OR CONSEQUENTIAL LOSSES OR DAMAGES OF ANY NATURE ARISING OUT OF OR IN CONNECTION WITH THE USE OF OR INABILITY TO USE THE THE WEBSITE OR FOR ANY BREACH OF SECURITY ASSOCIATED WITH THE TRANSMISSION OF SENSITIVE INFORMATION THROUGH THE WEBSITE OR FOR ANY INFORMATION OBTAINED THROUGH THE WEBSITE, INCLUDING, WITHOUT LIMITATION, DAMAGES FOR LOST PROFITS, LOSS OF GOODWILL, LOSS OR CORRUPTION OF DATA, WORK STOPPAGE, ACCURACY OF RESULTS, OR COMPUTER FAILURE OR MALFUNCTION, EVEN IF AN AUTHORIZED REPRESENTATIVE OF THE OPERATORS HAS BEEN ADVISED OF OR SHOULD HAVE KNOWN OF THE POSSIBILITY OF SUCH DAMAGES.</p>  <p>THE OPERATORS''S TOTAL CUMULATIVE LIABILITY FOR ANY AND ALL CLAIMS IN CONNECTION WITH THE WEBSITE WILL NOT EXCEED FIVE U.S. DOLLARS ($5.00). USER AGREES AND ACKNOWLEDGES THAT THE FOREGOING LIMITATIONS ON LIABILITY ARE AN ESSENTIAL BASIS OF THE BARGAIN AND THAT THE OPERATORS WOULD NOT PROVIDE THE WEBSITE ABSENT SUCH LIMITATION.</p>  <h2>Links to Other Materials.</h2>  <p>The Website may contain links to sites owned or operated by independent third parties. These links are provided for your convenience and reference only. We do not control such sites and, therefore, we are not responsible for any content posted on these sites. The fact that the Operators offer such links should not be construed in any way as an endorsement, authorization, or sponsorship of that site, its content or the companies or products referenced therein, and the Operators reserve the right to note its lack of affiliation, sponsorship, or endorsement on the Website. If you decide to access any of the third party sites linked to by the Website, you do this entirely at your own risk. Because some sites employ automated search results or otherwise link you to sites containing information that may be deemed inappropriate or offensive, the Operators cannot be held responsible for the accuracy, copyright compliance, legality, or decency of material contained in third party sites, and you hereby irrevocably waive any claim against us with respect to such sites.</p>  <h2><span>Notification Of Possible Copyright Infringement</span></h2>  <p>In the event you believe that material or content published on the Website may infringe on your copyright or that of another, please<span>contact</span> us.</p>', N'terms', CAST(N'2014-11-12 04:22:12.300' AS DateTime))
GO
SET IDENTITY_INSERT [dbo].[PageContents] OFF
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 4)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 5)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 6)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 7)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 8)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 9)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 10)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 11)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 12)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag1', 13)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 4)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 5)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 6)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 7)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 8)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 9)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 10)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 11)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 12)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag2', 13)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 4)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 5)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 6)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 7)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 8)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 9)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 10)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 11)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 12)
GO
INSERT [dbo].[Tags] ([Tag], [TopicId]) VALUES (N'tag3', 13)
GO
SET IDENTITY_INSERT [dbo].[Topics] ON 

GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (4, N'This is my first thread', N'this-is-my-first-thread', N'Using this', CAST(N'2014-11-12 23:27:36.303' AS DateTime), CAST(N'2014-11-12 23:27:36.303' AS DateTime), 1, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', NULL, 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (5, N'My second thread', N'my-second-thread', N'Second thread here', CAST(N'2014-11-12 23:28:04.933' AS DateTime), CAST(N'2014-11-12 23:28:04.933' AS DateTime), 2, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', NULL, 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (6, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 02:49:55.793' AS DateTime), CAST(N'2014-11-13 02:49:55.793' AS DateTime), 0, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (7, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 02:50:08.980' AS DateTime), CAST(N'2014-11-13 02:50:08.980' AS DateTime), 0, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (8, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 02:50:17.470' AS DateTime), CAST(N'2014-11-13 02:50:17.470' AS DateTime), 0, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (9, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 02:58:20.763' AS DateTime), CAST(N'2014-11-13 02:58:20.763' AS DateTime), 0, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (10, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 02:58:31.623' AS DateTime), CAST(N'2014-11-13 02:58:31.623' AS DateTime), 0, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (11, N'This new post of mine', N'this-new-post-of-mine', N'I''m gonna let it shine', CAST(N'2014-11-13 03:02:50.273' AS DateTime), CAST(N'2014-11-13 03:02:50.273' AS DateTime), 14, 3, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'1527e91f-4811-48db-bef5-25fa443b9127', 1, 0, NULL, 3, 3, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (12, N'Posting at midnight', N'posting-at-midnight', N'Why is this box so small', CAST(N'2014-11-13 08:23:56.350' AS DateTime), CAST(N'2014-11-13 08:23:56.350' AS DateTime), 4, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'719410fa-f826-4394-8d6c-b1b0c6e96274', 1, 0, NULL, NULL, 0, NULL, 1)
GO
INSERT [dbo].[Topics] ([TopicId], [TopicTitle], [TopicShortName], [TopicDescription], [TopicCreationDate], [TopicLastEditDate], [TopicViews], [TopicReplies], [UserId], [TopicTags], [ForumId], [TopicLastEditIp], [TopicLastEditUser], [Active], [TopicIsClose], [TopicOrder], [LastMessageId], [MessagesIdentity], [ReadAccessGroupId], [PostAccessGroupId]) VALUES (13, N'This is my thread today', N'this-is-my-thread-today', N'This is the actual text', CAST(N'2014-11-13 20:49:59.897' AS DateTime), CAST(N'2014-11-13 20:49:59.897' AS DateTime), 1, 0, N'719410fa-f826-4394-8d6c-b1b0c6e96274', N'tag1 tag2 tag3', 3, N'::1', N'719410fa-f826-4394-8d6c-b1b0c6e96274', 1, 0, NULL, NULL, 0, NULL, 1)
GO
SET IDENTITY_INSERT [dbo].[Topics] OFF
GO
INSERT [dbo].[UsersGroups] ([UserGroupId], [UserGroupName]) VALUES (1, N'Member')
GO
INSERT [dbo].[UsersGroups] ([UserGroupId], [UserGroupName]) VALUES (2, N'Trusted member')
GO
INSERT [dbo].[UsersGroups] ([UserGroupId], [UserGroupName]) VALUES (3, N'Moderator')
GO
INSERT [dbo].[UsersGroups] ([UserGroupId], [UserGroupName]) VALUES (10, N'Admin')
GO
ALTER TABLE [dbo].[AspNetUserClaims]  WITH CHECK ADD  CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserClaims] CHECK CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[AspNetUserLogins]  WITH CHECK ADD  CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserLogins] CHECK CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[AspNetUserRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY([RoleId])
REFERENCES [dbo].[AspNetRoles] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserRoles] CHECK CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId]
GO
ALTER TABLE [dbo].[AspNetUserRoles]  WITH CHECK ADD  CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY([UserId])
REFERENCES [dbo].[AspNetUsers] ([Id])
ON DELETE CASCADE
GO
ALTER TABLE [dbo].[AspNetUserRoles] CHECK CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId]
GO
ALTER TABLE [dbo].[Flags]  WITH CHECK ADD  CONSTRAINT [FK_Flags_Messages] FOREIGN KEY([TopicId], [MessageId])
REFERENCES [dbo].[Messages] ([TopicId], [MessageId])
GO
ALTER TABLE [dbo].[Flags] CHECK CONSTRAINT [FK_Flags_Messages]
GO
ALTER TABLE [dbo].[Forums]  WITH CHECK ADD  CONSTRAINT [FK_Forums_ForumsCategories] FOREIGN KEY([CategoryId])
REFERENCES [dbo].[ForumsCategories] ([CategoryId])
GO
ALTER TABLE [dbo].[Forums] CHECK CONSTRAINT [FK_Forums_ForumsCategories]
GO
ALTER TABLE [dbo].[Forums]  WITH CHECK ADD  CONSTRAINT [FK_Forums_UsersGroups_Post] FOREIGN KEY([PostAccessGroupId])
REFERENCES [dbo].[UsersGroups] ([UserGroupId])
GO
ALTER TABLE [dbo].[Forums] CHECK CONSTRAINT [FK_Forums_UsersGroups_Post]
GO
ALTER TABLE [dbo].[Forums]  WITH CHECK ADD  CONSTRAINT [FK_Forums_UsersGroups_Read] FOREIGN KEY([ReadAccessGroupId])
REFERENCES [dbo].[UsersGroups] ([UserGroupId])
GO
ALTER TABLE [dbo].[Forums] CHECK CONSTRAINT [FK_Forums_UsersGroups_Read]
GO
ALTER TABLE [dbo].[Messages]  WITH CHECK ADD  CONSTRAINT [FK__Messages__Messag__0C70CFB4] FOREIGN KEY([MessageRemovalReasonId])
REFERENCES [dbo].[MessageRemovalReasons] ([MessageRemovalReasonId])
GO
ALTER TABLE [dbo].[Messages] CHECK CONSTRAINT [FK__Messages__Messag__0C70CFB4]
GO
ALTER TABLE [dbo].[Messages]  WITH CHECK ADD  CONSTRAINT [FK_Messages_Topics] FOREIGN KEY([TopicId])
REFERENCES [dbo].[Topics] ([TopicId])
GO
ALTER TABLE [dbo].[Messages] CHECK CONSTRAINT [FK_Messages_Topics]
GO
ALTER TABLE [dbo].[Tags]  WITH CHECK ADD  CONSTRAINT [FK_Tags_Topics] FOREIGN KEY([TopicId])
REFERENCES [dbo].[Topics] ([TopicId])
GO
ALTER TABLE [dbo].[Tags] CHECK CONSTRAINT [FK_Tags_Topics]
GO
ALTER TABLE [dbo].[Topics]  WITH CHECK ADD  CONSTRAINT [FK_Topics_Forums] FOREIGN KEY([ForumId])
REFERENCES [dbo].[Forums] ([ForumId])
GO
ALTER TABLE [dbo].[Topics] CHECK CONSTRAINT [FK_Topics_Forums]
GO
ALTER TABLE [dbo].[Topics]  WITH CHECK ADD  CONSTRAINT [FK_Topics_UsersGroups_Post] FOREIGN KEY([PostAccessGroupId])
REFERENCES [dbo].[UsersGroups] ([UserGroupId])
GO
ALTER TABLE [dbo].[Topics] CHECK CONSTRAINT [FK_Topics_UsersGroups_Post]
GO
ALTER TABLE [dbo].[Topics]  WITH CHECK ADD  CONSTRAINT [FK_Topics_UsersGroups_Read] FOREIGN KEY([ReadAccessGroupId])
REFERENCES [dbo].[UsersGroups] ([UserGroupId])
GO
ALTER TABLE [dbo].[Topics] CHECK CONSTRAINT [FK_Topics_UsersGroups_Read]
GO
ALTER TABLE [dbo].[TopicsSubscriptions]  WITH CHECK ADD  CONSTRAINT [FK_TopicsSubscriptions_Topics] FOREIGN KEY([TopicId])
REFERENCES [dbo].[Topics] ([TopicId])
GO
ALTER TABLE [dbo].[TopicsSubscriptions] CHECK CONSTRAINT [FK_TopicsSubscriptions_Topics]
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesDelete]
	@categoryId int
AS
BEGIN
	DELETE FROM ForumsCategories WHERE CategoryId = @categoryId
END
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesGet] 
	@CategoryId int
AS
BEGIN
	
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT * FROM ForumsCategories WHERE CategoryId = @CategoryId
END
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesGetAll]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesGetAll]
AS
SELECT 
	CategoryId
	,CategoryName
	,CategoryOrder
FROM
	ForumsCategories
ORDER BY
	CategoryOrder
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesGetForumsCountPerCategory]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesGetForumsCountPerCategory] 
	@CategoryId int 
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT  count(*) as NoofForums FROM Forums WHERE CategoryId = @CategoryId 
END
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesInsert] 
	-- Add the parameters for the stored procedure here
	@categoryName nvarchar(255),
	@categoryOrder int
AS
BEGIN
	INSERT INTO ForumsCategories
	(
		CategoryName,
		CategoryOrder
	)
	VALUES
	(
		@categoryName,
		@categoryOrder
	)
END
GO
/****** Object:  StoredProcedure [dbo].[SPForumsCategoriesUpdate]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsCategoriesUpdate] 
	@CategoryId int,
	@CategoryName nvarchar(255),
	@CategoryOrder int
AS
BEGIN
	UPDATE ForumsCategories
	SET
	CategoryName = @CategoryName,
	CategoryOrder = @CategoryOrder
	WHERE
	CategoryId = @CategoryId
END


/****** Object:  StoredProcedure [dbo].[SPForumsDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsDelete]
	@ForumShortName nvarchar(32)
AS

UPDATE Forums
SET
	Active = 0
WHERE
	ForumShortName = @ForumShortName
GO
/****** Object:  StoredProcedure [dbo].[SPForumsGetByCategory]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsGetByCategory]
	@UserGroupId smallint=NULL
AS

SELECT
	F.ForumId
	,F.ForumName
	,F.ForumShortName
	,F.ForumDescription
	,F.ForumCreationDate
	,F.ForumTopicCount
	,F.ForumMessageCount
	,C.CategoryId
	,C.CategoryName
	,T.TopicId
	,T.TopicCreationDate
	,T.TopicTitle
	,T.TopicShortName
	,T.UserId as [UserId]
	,COALESCE(TU.UserName, '') as [UserName]
	
FROM
	ForumsCategories C
	INNER JOIN Forums F ON F.CategoryId = C.CategoryId
	
	LEFT OUTER JOIN	Topics T on T.TopicId = 
		(
			Select top 1 TopicId from Topics 
			where ISNULL(Topics.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1) and F.ForumId = Topics.ForumId and Topics.Active = 1
			Order By TopicId Desc
		)
	LEFT OUTER JOIN	AspNetUsers TU on TU.Id = T.UserId
	
WHERE
	F.Active = 1
	AND
	ISNULL(F.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
ORDER BY
	C.CategoryOrder,
	F.ForumOrder
GO
/****** Object:  StoredProcedure [dbo].[SPForumsGetByShortName]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsGetByShortName]
	@ShortName nvarchar(32)
AS
SELECT
	F.ForumId
	,F.ForumName
	,F.ForumShortName
	,F.ForumDescription
	,F.UserId
	,F.ForumCreationDate
	,F.ForumTopicCount
	,F.ForumMessageCount
	,C.CategoryId
	,C.CategoryName
	,F.ReadAccessGroupId
	,F.PostAccessGroupId
FROM
	Forums F 
	INNER JOIN ForumsCategories C ON F.CategoryId = C.CategoryId
WHERE
	F.ForumShortName = @ShortName
	AND
	F.Active = 1
GO
/****** Object:  StoredProcedure [dbo].[SPForumsGetUsedShortNames]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsGetUsedShortNames]
(
	@ForumShortName nvarchar(32), 
	@SearchShortName nvarchar(32)
)
AS
/*
	Gets used short names for forums
	returns:
		IF NOT USED SHORTNAME: empty result set
		IF USED SHORTNAME: resultset with amount of rows used
*/
DECLARE @CurrentValue nvarchar(32)
SELECT 
	@CurrentValue = ForumShortName
FROM 
	Forums
WHERE
	ForumShortName = @ForumShortName
	

IF @CurrentValue IS NULL
	SELECT NULL As ForumShortName WHERE 1=0
ELSE
	SELECT 
		ForumShortName
	FROM
		Forums
	WHERE
		ForumShortName LIKE @SearchShortName + '%'
		OR
		ForumShortName = @ForumShortName
GO
/****** Object:  StoredProcedure [dbo].[SPForumsInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsInsert]
(
	@ForumName nvarchar(255)
	,@ForumShortName nvarchar(32)
	,@ForumDescription nvarchar(max)
	,@CategoryId int
	,@UserId uniqueidentifier
	,@ReadAccessGroupId smallint
	,@PostAccessGroupId smallint
)
AS
INSERT INTO Forums
(
	ForumName
	,ForumShortName
	,ForumDescription
	,CategoryId
	,UserId
	,ForumCreationDate
	,ForumLastEditDate
	,ForumLastEditUser
	,Active
	,ForumTopicCount
	,ForumMessageCount
	,ForumOrder
	,ReadAccessGroupId
	,PostAccessGroupId
)
VALUES
(
	@ForumName
	,@ForumShortName
	,@ForumDescription
	,@CategoryId
	,@UserId
	,GETUTCDATE()
	,GETUTCDATE()
	,@UserId
	,1
	,0
	,0
	,0
	,@ReadAccessGroupId
	,@PostAccessGroupId
)
GO
/****** Object:  StoredProcedure [dbo].[SPForumsUpdate]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsUpdate]
(
	@ForumShortName nvarchar(32)
	,@ForumName nvarchar(255)
	,@ForumDescription nvarchar(max)
	,@CategoryId int
	,@UserId uniqueidentifier
	,@ReadAccessGroupId smallint
	,@PostAccessGroupId smallint
)
AS
UPDATE Forums
SET
	ForumName = @ForumName
	,ForumDescription = @ForumDescription 
	,CategoryId = @CategoryId
	,ForumLastEditDate = GETUTCDATE()
	,ForumLastEditUser = @UserId
	,ReadAccessGroupId = @ReadAccessGroupId
	,PostAccessGroupId = @PostAccessGroupId
WHERE
	ForumShortName = @ForumShortName
GO
/****** Object:  StoredProcedure [dbo].[SPForumsUpdateLastMessage]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsUpdateLastMessage]
	@TopicId int
	,@MessageId int
AS

UPDATE F
SET
	F.ForumMessageCount = F.ForumMessageCount + 1
FROM
	Topics T
	INNER JOIN Forums F ON F.ForumId = T.ForumId
WHERE
  T.TopicId = @TopicId;
GO
/****** Object:  StoredProcedure [dbo].[SPForumsUpdateRecount]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPForumsUpdateRecount]
	@ForumId int = 2
AS
/*
	RECOUNTS THE CHILDREN MESSAGES AND TOPICS
*/
DECLARE @ForumTopicCount int, @ForumMessageCount int;

SELECT
	@ForumTopicCount = COUNT(TopicId)
	,@ForumMessageCount = SUM(TopicReplies)
FROM
	Topics
WHERE
	ForumId = @ForumId
	AND
	Active = 1;

UPDATE Forums
SET 
	ForumTopicCount = ISNULL(@ForumTopicCount, 0)
	,ForumMessageCount = ISNULL(@ForumMessageCount, 0)
WHERE	
	ForumId = @ForumId;
GO
/****** Object:  StoredProcedure [dbo].[SPMessageRemovalReasonsGetAll]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
Create procedure [dbo].[SPMessageRemovalReasonsGetAll]
As
Begin

	Select MessageRemovalReasonId, Title, ReasonText, HideMessage
	From MessageRemovalReasons

End
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[SPMessagesDelete]
	@TopicId int
	,@MessageId int
	,@UserId uniqueidentifier
	,@MessageRemovalReasonID int = null
As
Begin

	Update Messages  
	Set  
		Active = 0  
		,MessageLastEditDate = GETUTCDATE()  
		,MessageLastEditUser = @UserId
		,MessageRemovalReasonID = @MessageRemovalReasonID
	WHERE  
		TopicId = @TopicId  
		AND MessageId = @MessageId

End
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesFlag]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesFlag]
(
	@TopicId int=1
	,@MessageId int=1
	,@Ip varchar (39)='127.0.0.1'
)
AS
IF NOT EXISTS (SELECT * FROM Flags WHERE TopicId=@TopicId AND IP=@Ip AND (MessageId=@MessageId OR (@MessageId IS NULL AND MessageId IS NULL)))
	BEGIN
	INSERT INTO Flags
	(TopicId, MessageId, Ip, FlagDate)
	VALUES
	(@TopicId, @MessageId, @Ip, GETUTCDATE())
	END
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesFlagGetCount]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
Create procedure [dbo].[SPMessagesFlagGetCount]
As
Begin

	Select Count(*) as [Count]
	FROM
		Flags F
		INNER JOIN Topics T ON T.TopicId = F.TopicId
		INNER JOIN Forums ON Forums.ForumId = T.ForumId
		INNER JOIN MessagesComplete M ON M.TopicId = T.TopicId AND M.MessageId = F.MessageId
	WHERE
		T.Active = 1
		AND	
		M.Active = 1
End
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesFlagsClear]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesFlagsClear]
(
	@TopicId int=1
	,@MessageId int=1
)
AS
DELETE FROM 
	Flags
WHERE
	TopicId = @TopicId
	AND
	MessageId = @MessageId
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesFlagsGetAll]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesFlagsGetAll]
(
	@StartIndex int = 0
	,@Length int = 10
)
AS
/*
	Lists all flagged messages (not topics)
*/

SELECT *
FROM
	(SELECT
		ROW_NUMBER() OVER (ORDER BY COUNT(FlagId) DESC, F.TopicId) AS RowNumber
		,F.TopicId
		,F.MessageId
		,COUNT(FlagId) AS TotalFlags
		,T.TopicTitle
		,T.TopicShortName
		,Forums.ForumId
		,Forums.ForumShortName
		,Forums.ForumName
		,M.MessageBody
		,M.UserName
		,M.UserId
	FROM
		Flags F
		INNER JOIN Topics T ON T.TopicId = F.TopicId
		INNER JOIN Forums ON Forums.ForumId = T.ForumId
		INNER JOIN MessagesComplete M ON M.TopicId = T.TopicId AND M.MessageId = F.MessageId
	WHERE
		T.Active = 1
		AND	
		M.Active = 1
	GROUP BY	
		F.TopicId
		,F.MessageId
		,T.TopicTitle
		,T.TopicShortName
		,Forums.ForumId
		,Forums.ForumShortName
		,Forums.ForumName
		,M.MessageBody
		,M.UserName
		,M.UserId
	) T
WHERE
	RowNumber BETWEEN @StartIndex+1 AND @StartIndex + @Length
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesGet]
	@TopicId int=1,
	@MessageId int=1
AS
SELECT 
	F.ForumId
	,F.ForumName
	,F.ForumShortName
	,T.TopicId
	,T.TopicTitle
	,T.TopicShortName
	,M.MessageId
	,M.MessageBody
	,M.MessageCreationDate
	,M.MessageLastEditDate
	,M.ParentId
	,M.UserId
	,M.UserName
	,M.UserSignature
	,M.UserGroupId
	,M.UserGroupName
	,M.UserPhoto
	,M.UserRegistrationDate
	,M.Active
	
FROM 
	MessagesComplete M
		Inner join Topics T on T.TopicId = M.TopicId
		Inner join Forums F on F.ForumId = T.ForumId
WHERE 
	M.TopicId = @TopicId
	AND
	M.MessageId = @MessageId
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesGetByTopic]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesGetByTopic]
	@TopicId int=2
AS
SELECT 
	ROW_NUMBER()
			OVER 
				(ORDER BY M.TopicId, M.MessageId)
			AS RowNumber
	,M.TopicId
	,M.MessageId
	,M.MessageBody
	,M.MessageCreationDate
	,M.MessageLastEditDate
	,M.ParentId
	,UserId
	,UserName
	,UserSignature
	,UserGroupId
	,UserGroupName
	,UserPhoto
	,UserRegistrationDate
	,M.Active
FROM 
	dbo.MessagesComplete M
WHERE 
	M.TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesGetByTopicFrom]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE procedure [dbo].[SPMessagesGetByTopicFrom]
	@TopicId int=1,
	@FirstMsg int=13,
	@Amount int=10
As
Begin

	Select 
		RowNumber
		,TopicId  
		,MessageId  
		,MessageBody  
		,MessageCreationDate  
		,MessageLastEditDate  
		,ParentId  
		,UserId  
		,UserName  
		,UserSignature  
		,UserGroupId  
		,UserGroupName  
		,UserPhoto  
		,UserRegistrationDate  
		,Active
		,ReasonText
		,HideMessage 
	From (  
		Select   
			ROW_NUMBER() OVER (ORDER BY M.TopicId, M.MessageId) AS RowNumber
			,M.TopicId  
			,M.MessageId  
			,M.MessageBody  
			,M.MessageCreationDate  
			,M.MessageLastEditDate  
			,M.ParentId  
			,UserId  
			,UserName  
			,UserSignature  
			,UserGroupId  
			,UserGroupName  
			,UserPhoto  
			,UserRegistrationDate  
			,M.Active
			,MessageRemovalReasons.ReasonText
			,MessageRemovalReasons.HideMessage
		From    
			dbo.MessagesComplete M
				left outer join MessageRemovalReasons on MessageRemovalReasons.MessageRemovalReasonID =  M.MessageRemovalReasonID 
		Where   
			M.TopicId = @TopicId  
			AND M.MessageId > @FirstMsg
	) M  
	Where  
	RowNumber <= @Amount

End
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesGetByTopicLatest]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesGetByTopicLatest]
	@TopicId int=2
AS
SELECT 
	TOP 20
	M.TopicId
	,M.MessageId
	,M.MessageBody
	,M.MessageCreationDate
	,M.MessageLastEditDate
	,M.ParentId
	,UserId
	,UserName
	,UserSignature
	,UserGroupId
	,UserGroupName
	,M.Active
FROM 
	dbo.MessagesComplete M
WHERE 
	M.TopicId = @TopicId
ORDER BY
	TopicId, MessageId DESC
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesGetByTopicUpTo]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesGetByTopicUpTo]
	@TopicId int=1,
	@FirstMsg int=3,
	@LastMsg int=28
AS
SELECT 
	ROW_NUMBER()
			OVER 
				(ORDER BY M.TopicId, M.MessageId)
			AS RowNumber
	,M.TopicId
	,M.MessageId
	,M.MessageBody
	,M.MessageCreationDate
	,M.MessageLastEditDate
	,M.ParentId
	,UserId
	,UserName
	,UserSignature
	,UserGroupId
	,UserGroupName
	,UserPhoto
	,UserRegistrationDate
	,M.Active
FROM 
	dbo.MessagesComplete M
WHERE 
	M.TopicId = @TopicId
	AND
	M.MessageId > @FirstMsg
	AND
	M.MessageId <= @LastMsg
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPMessagesInsert]
	@TopicId int
	,@MessageBody nvarchar(max)
	,@UserId uniqueidentifier
	,@MessageId int OUTPUT
	,@Ip varchar (39)
	,@ParentId int
AS

UPDATE T
	SET
	MessagesIdentity = MessagesIdentity+1
	,@MessageId = MessagesIdentity+1
FROM
	Topics T
WHERE
	TopicId = @TopicId


BEGIN TRY
	BEGIN TRANSACTION

	INSERT INTO Messages
	(
	TopicId
	,MessageId
	,MessageBody
	,MessageCreationDate
	,MessageLastEditDate
	,MessageLastEditUser
	,UserId
	,Active
	,EditIp
	,ParentId
	)
	VALUES
	(
	@TopicId
	,@MessageId
	,@MessageBody
	,GETUTCDATE()
	,GETUTCDATE()
	,@UserId
	,@UserId
	,1
	,@Ip
	,@ParentId
	)


	
	--Update topic
	exec SPTopicsUpdateLastMessage @TopicId=@TopicId, @MessageId=@MessageId
	--Update forums
	exec SPForumsUpdateLastMessage @TopicId=@TopicId, @MessageId=@MessageId
	COMMIT

END TRY
BEGIN CATCH
	IF @@TRANCOUNT > 0
		ROLLBACK

  -- Raise an error with the details of the exception
	DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int
	SELECT @ErrMsg = ERROR_MESSAGE(),
		 @ErrSeverity = ERROR_SEVERITY()

	RAISERROR(@ErrMsg, @ErrSeverity, 1)

END CATCH
GO
/****** Object:  StoredProcedure [dbo].[SPMessagesUpdate]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
Create PROCEDURE [dbo].[SPMessagesUpdate]
	@TopicId int
	,@MessageId int
	,@MessageBody nvarchar(max)
	,@UserId uniqueidentifier
	,@Ip varchar (39)
AS

	UPDATE M
	SET
		MessageBody = @MessageBody
		,MessageLastEditDate = GETUTCDATE()
		,EditIp = @Ip
		,MessageLastEditUser = @UserId
	FROM
		Messages M
	WHERE
		TopicId = @TopicId
		and MessageId = @MessageId
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsDelete]
	@PageContentShortName nvarchar(128)
AS
DELETE FROM PageContents 
WHERE
	PageContentShortName = @PageContentShortName
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsGet]
	@PageContentShortName nvarchar(128)='about'
AS
SELECT
	PageContentId
	,PageContentTitle
	,PageContentBody
	,PageContentShortName
FROM
	dbo.PageContents
WHERE
	PageContentShortName = @PageContentShortName
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsGetAll]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsGetAll]
	
AS
SELECT
	PageContentId
	,PageContentTitle
	,PageContentBody
	,PageContentShortName
FROM
	dbo.PageContents
ORDER BY
	PageContentTitle
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsGetUsedShortNames]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsGetUsedShortNames]
(
	@PageContentShortName nvarchar(32), 
	@SearchShortName nvarchar(32)
)
AS
/*
	Gets used short names for PageContents
	returns:
		IF NOT USED SHORTNAME: empty result set
		IF USED SHORTNAME: resultset with amount of rows used
*/
DECLARE @CurrentValue nvarchar(32)
SELECT 
	@CurrentValue = PageContentShortName
FROM 
	PageContents
WHERE
	PageContentShortName = @PageContentShortName
	

IF @CurrentValue IS NULL
	SELECT NULL As ForumShortName WHERE 1=0
ELSE
	SELECT 
		PageContentShortName
	FROM
		PageContents
	WHERE
		PageContentShortName LIKE @SearchShortName + '%'
		OR
		PageContentShortName = @PageContentShortName
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsInsert]
	@PageContentShortName nvarchar(128)
	,@PageContentTitle nvarchar(128)
	,@PageContentBody nvarchar(max)
AS
INSERT INTO PageContents 
(
PageContentTitle
,PageContentBody
,PageContentShortName
,PageContentEditDate
)
VALUES
(
@PageContentTitle
,@PageContentBody
,@PageContentShortName
,GETUTCDATE()
)
GO
/****** Object:  StoredProcedure [dbo].[SPPageContentsUpdate]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPPageContentsUpdate]
	@PageContentShortName nvarchar(128)
	,@PageContentTitle nvarchar(128)
	,@PageContentBody nvarchar(max)
AS
UPDATE PageContents 
SET
	PageContentTitle = @PageContentTitle
	,PageContentBody = @PageContentBody
	,PageContentEditDate = GETUTCDATE()
WHERE
	PageContentShortName = @PageContentShortName
GO
/****** Object:  StoredProcedure [dbo].[SPSettingsGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPSettingsGet]
	@SettingKey varchar(256)
AS
SELECT 
	SettingKey, SettingValue, SettingDate
FROM 
	Settings
WHERE
	SettingKey = @SettingKey
GO
/****** Object:  StoredProcedure [dbo].[SPSettingsSet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPSettingsSet]
	@SettingKey varchar(256)
	,@SettingValue nvarchar(max)
AS
IF EXISTS (SELECT * FROM Settings WHERE SettingKey=@SettingKey)
	BEGIN
	UPDATE Settings	
	SET SettingValue = @SettingValue, 
		SettingDate = GETUTCDATE()
	WHERE SettingKey=@SettingKey
	END
ELSE
	BEGIN
	INSERT INTO Settings (SettingKey, SettingValue, SettingDate)
	VALUES (@SettingKey, @SettingValue, GETUTCDATE())
	END
GO
/****** Object:  StoredProcedure [dbo].[SPTagsGetMostViewed]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTagsGetMostViewed]
	@ForumId int=2
	,@Top bigint=5
AS
SELECT
	Tag, 
	TagViews, 
	(TagViews*100.00)/SUM(case when TagViews > 0 then TagViews else 1 end) OVER() AS Weight
FROM
	(
	SELECT
		TOP (@Top)
		Tags.Tag
		,SUM(T.TopicViews) As TagViews
		,COUNT(T.TopicId) As TopicCount
	FROM
		Tags
		INNER JOIN Topics T ON Tags.TopicId = T.TopicId
	WHERE
		T.ForumId = @ForumId
		AND
		T.Active = 1
	GROUP BY
		Tags.Tag
	ORDER BY SUM(T.TopicViews) desc
	) T
ORDER BY Tag
GO
/****** Object:  StoredProcedure [dbo].[SPTagsInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTagsInsert]
	@Tags nvarchar(256),
	@TopicId int,
	@PreviousTags nvarchar(256)=NULL
AS

IF NOT @PreviousTags IS NULL
	BEGIN
	DELETE FROM Tags
	WHERE
		Tag IN (SELECT part FROM dbo.Split(@PreviousTags, ' '))
		AND
		TopicId = @TopicId
	END

INSERT INTO Tags
(Tag,TopicId)
SELECT part, @TopicId FROM dbo.Split(@Tags, ' ')
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesDelete]
	@TemplateId int
AS
DELETE FROM Templates WHERE TemplateId = @TemplateId
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesGet]
	@TemplateId int
AS
SELECT
	TemplateId
	,TemplateKey
	,TemplateDescription
	,TemplateIsCurrent
FROM
	Templates
WHERE
	TemplateId = @TemplateId
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesGetAll]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesGetAll]
AS
SELECT
	TemplateId
	,TemplateKey
	,TemplateDescription
	,TemplateIsCurrent
FROM
	Templates
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesGetCurrent]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesGetCurrent]

AS
SELECT
	TemplateId
	,TemplateKey
	,TemplateDescription
FROM
	Templates
WHERE
	TemplateIsCurrent = 1
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesInsert]
	@TemplateKey nvarchar(64)
	,@TemplateDescription nvarchar(256)
	,@TemplateId int OUTPUT
AS

SELECT @TemplateId = TemplateId 
FROM Templates WHERE TemplateKey=@TemplateKey;

IF @TemplateId IS NULL
	BEGIN
	INSERT INTO Templates
	(
		TemplateKey
		,TemplateDescription
		,TemplateDate
		,TemplateIsCurrent
	)
	VALUES
	(
		@TemplateKey
		,@TemplateDescription
		,GETUTCDATE()
		,0
	);

	SELECT @TemplateId = @@IDENTITY;
	
	END
ELSE
	BEGIN
	UPDATE Templates
	SET
		TemplateDescription = @TemplateDescription
		,TemplateDate = GETUTCDATE()
	WHERE 
		TemplateKey=@TemplateKey;
	END
GO
/****** Object:  StoredProcedure [dbo].[SPTemplatesUpdateCurrent]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTemplatesUpdateCurrent]
	@TemplateId int
AS
UPDATE T
SET
	TemplateIsCurrent = 
		CASE WHEN TemplateId = @TemplateId THEN 1 ELSE 0 END
FROM
	Templates T
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsAddVisit]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsAddVisit]
	@TopicId int=2
AS
UPDATE Topics
SET
	TopicViews = TopicViews+1
WHERE
	TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsClose]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsClose]
	@TopicId int
	,@UserId uniqueidentifier
	,@Ip varchar (39)
AS
	UPDATE Topics
	SET
		TopicIsClose = 1
		,TopicLastEditDate = GETUTCDATE()
		,TopicLastEditUser = @UserId
		,TopicLastEditIp = @Ip
	WHERE
		TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsDelete]
	@TopicId int
	,@UserId uniqueidentifier
	,@Ip varchar (39)
AS
/*
- SETS THE TOPIC ACTIVE=0
- UPDATES RECOUNT ON FORUM
*/

DECLARE @ForumId int;
SELECT @ForumId = ForumId FROM Topics WHERE TopicId = @TopicId;

UPDATE Topics
SET
	Active = 0
	,TopicLastEditDate = GETUTCDATE()
	,TopicLastEditUser = @UserId
	,TopicLastEditIp = @Ip
WHERE
	TopicId = @TopicId;

exec dbo.SPForumsUpdateRecount @ForumId;
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGet]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGet]
	@TopicId int=1
AS
SELECT
	T.TopicId  
	,T.TopicTitle  
	,T.TopicShortName  
	,T.TopicDescription  
	,T.TopicCreationDate  
	,T.TopicViews  
	,T.TopicReplies  
	,T.UserId  
	,T.TopicTags  
	,T.TopicIsClose  
	,T.TopicOrder  
	,T.LastMessageId  
	,T.UserName
	,T.UserPhoto
	,T.UserRegistrationDate
	,T.UserSignature
	,T.UserGroupId
	,'' as "UserGroupName"
	,T.ForumId  
	,T.ForumName  
	,T.ForumShortName  
	,T.ReadAccessGroupId  
	,T.PostAccessGroupId  
FROM 
	TopicsComplete T    
WHERE
	T.TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByForum]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByForum]
	@ForumId int = 2
	,@StartIndex int = 0
	,@Length int = 10
	,@UserGroupId int = null
AS
SELECT
	*
FROM
	(SELECT
		ROW_NUMBER()
			OVER 
				(ORDER BY TopicOrder desc
				 ,TopicViews desc)
			AS RowNumber
		,T.TopicId
		,T.TopicTitle
		,T.TopicShortName
		,T.TopicDescription
		,T.TopicCreationDate
		,T.TopicViews
		,T.TopicReplies
		,T.UserId
		,T.TopicTags
		,T.TopicIsClose
		,T.TopicOrder
		,T.LastMessageId
		,T.UserName
		,M.MessageCreationDate
		,M.UserId AS MessageUserId
		,MU.UserName AS MessageUserName
		,T.ReadAccessGroupId
		,T.PostAccessGroupId
	FROM
		TopicsComplete T
		LEFT JOIN [Messages] M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
		LEFT JOIN AspNetUsers MU ON MU.Id = M.UserId
	WHERE
		T.ForumId = @ForumId
		AND
		ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
	) T
WHERE
	RowNumber BETWEEN @StartIndex+1 AND @StartIndex + @Length
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByForumLatest]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByForumLatest]
	@ForumId int = 2
	,@StartIndex int = 0
	,@Length int = 10
	,@UserGroupId int = null
AS
SELECT
	*
FROM
	(SELECT
		ROW_NUMBER()
			OVER 
				(ORDER BY TopicOrder desc
				 ,
				 (CASE 
					WHEN M.MessageCreationDate > T.TopicCreationDate THEN M.MessageCreationDate
					ELSE T.TopicCreationDate
				END) desc)
			AS RowNumber
		,T.TopicId
		,T.TopicTitle
		,T.TopicShortName
		,T.TopicDescription
		,T.TopicCreationDate
		,T.TopicViews
		,T.TopicReplies
		,T.UserId
		,T.TopicTags
		,T.TopicIsClose
		,T.TopicOrder
		,T.LastMessageId
		,T.UserName
		,M.MessageCreationDate
		,M.UserId AS MessageUserId
		,MU.UserName AS MessageUserName
		,T.ReadAccessGroupId
		,T.PostAccessGroupId
	FROM
		TopicsComplete T
		LEFT JOIN [Messages] M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
		LEFT JOIN AspNetUsers MU ON MU.Id = M.UserId
	WHERE
		T.ForumId = @ForumId
		AND
		ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
	) T
WHERE
	RowNumber BETWEEN @StartIndex+1 AND @StartIndex + @Length
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByForumUnanswered]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByForumUnanswered]
	@ForumId int = 2
	,@UserGroupId int = null
AS
SELECT
	T.TopicId
	,T.TopicTitle
	,T.TopicShortName
	,T.TopicDescription
	,T.TopicCreationDate
	,T.TopicViews
	,T.TopicReplies
	,T.UserId
	,T.TopicTags
	,T.TopicIsClose
	,T.TopicOrder
	,T.LastMessageId
	,T.UserName
	,M.MessageCreationDate
	,M.UserId AS MessageUserId
	,MU.UserName AS MessageUserName
	,T.ReadAccessGroupId
	,T.PostAccessGroupId
FROM
	TopicsComplete T
	LEFT JOIN Messages M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
	LEFT JOIN AspNetUsers MU ON MU.Id = M.UserId
WHERE
	T.ForumId = @ForumId
	AND
	T.TopicReplies = 0 -- Unanswered
	AND
	T.TopicOrder IS NULL -- Not sticky	
	AND
	ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
ORDER BY 
	TopicViews DESC, TopicId DESC
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByRelated]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByRelated]
	@Tag1 nvarchar(50)='problem'
	,@Tag2 nvarchar(50)='installation'
	,@Tag3 nvarchar(50)='copy'
	,@Tag4 nvarchar(50)=null
	,@Tag5 nvarchar(50)=null
	,@Tag6 nvarchar(50)=null
	,@TopicId int=1
	,@Amount int=5
	,@UserGroupId int = null
AS
	
WITH TagsParams (Tag) AS
(
	SELECT @Tag1
	UNION
	SELECT @Tag2
	UNION
	SELECT @Tag3
	UNION
	SELECT @Tag4
	UNION
	SELECT @Tag5
	UNION
	SELECT @Tag6
)
SELECT
	TOP (@Amount)
	Ta.TagCount
	,Topics.TopicId
	,Topics.TopicTitle
	,Topics.TopicShortName
	,Topics.TopicDescription
	,Topics.TopicCreationDate
	,Topics.TopicViews
	,Topics.TopicReplies
	,Topics.ForumId
	,Topics.ForumName
	,Topics.ForumShortName
	,Topics.TopicIsClose
	,Topics.TopicOrder
	,Topics.ReadAccessGroupId
	,Topics.PostAccessGroupId
FROM
	(
	SELECT 
		T.TopicId
		,COUNT(T.Tag) AS TagCount
	FROM 
		Tags T
		INNER JOIN TagsParams P ON T.Tag=P.Tag
	WHERE
		T.Tag=P.Tag
	GROUP BY
		T.TopicId
	)
	Ta
	INNER JOIN TopicsComplete Topics ON Topics.TopicId = Ta.TopicId
WHERE
	Topics.TopicId <> @TopicId
	AND
	ISNULL(Topics.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
ORDER BY
	1 desc, Topics.TopicViews DESC
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByTag]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByTag]
	@Tag nvarchar(50)='forum'
	,@ForumId int=2
	,@UserGroupId int = null
AS

--Remove the last char
SET @Tag = SUBSTRING(@Tag, 1, LEN(@Tag)-1)
SELECT
		T.TopicId
		,T.TopicTitle
		,T.TopicShortName
		,T.TopicDescription
		,T.TopicCreationDate
		,T.TopicViews
		,T.TopicReplies
		,T.UserId
		,T.TopicTags
		,T.TopicIsClose
		,T.TopicOrder
		,T.LastMessageId
		,T.UserName
		,M.MessageCreationDate
		,M.UserId AS MessageUserId
		,MU.UserName AS MessageUserName
		,T.ReadAccessGroupId
		,T.PostAccessGroupId
FROM
	Tags
	INNER JOIN TopicsComplete T ON T.TopicId = Tags.TopicId
	LEFT JOIN Messages M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
	LEFT JOIN AspNetUsers MU ON MU.Id = M.UserId
WHERE
	Tags.Tag LIKE @Tag + '%'
	AND
	T.ForumId = @ForumId
	AND
	ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
ORDER BY TopicOrder DESC,TopicViews DESC
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetByUser]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetByUser]
	@UserId uniqueidentifier
	,@UserGroupId int = null
AS
SELECT
	T.TopicId
	,T.TopicTitle
	,T.TopicShortName
	,T.TopicDescription
	,T.TopicCreationDate
	,T.TopicViews
	,T.TopicReplies
	,T.UserId
	,T.TopicTags
	,T.TopicIsClose
	,T.TopicOrder
	,T.LastMessageId
	,T.UserName
	,M.MessageCreationDate
	,T.ReadAccessGroupId
	,T.PostAccessGroupId
FROM
	TopicsComplete T
	LEFT JOIN Messages M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
WHERE
	T.UserId = @UserId
	AND
	ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
ORDER BY T.TopicId DESC
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetLatest]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetLatest]
	@UserGroupId int = null
AS
/*
	Gets the latest messages in all forums	
*/
	SELECT
		TOP 20
		T.TopicId
		,T.TopicTitle
		,T.TopicShortName
		,T.TopicDescription
		,T.TopicCreationDate
		,T.TopicViews
		,T.TopicReplies
		,T.UserId
		,T.TopicTags
		,T.TopicIsClose
		,T.TopicOrder
		,T.LastMessageId
		,T.UserName
		,M.MessageCreationDate
	FROM
		TopicsComplete T
		LEFT JOIN Messages M ON M.TopicId = T.TopicId AND M.MessageId = T.LastMessageId AND M.Active = 1
	WHERE
		ISNULL(T.ReadAccessGroupId,-1) <= ISNULL(@UserGroupId,-1)
	ORDER BY T.TopicId desc
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetMessagesByUser]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetMessagesByUser]
	@UserId uniqueidentifier	
AS
/*
Gets the messages posted by the user grouped by topic
*/
SELECT
	T.TopicId
	,M.MessageId
	,M.MessageCreationDate
	,T.TopicTitle
	,T.TopicShortName
	,T.TopicDescription
	,T.TopicCreationDate
	,T.TopicViews
	,T.TopicReplies
	,T.UserId
	,T.TopicTags
	,T.TopicIsClose
	,T.TopicOrder
FROM
	TopicsComplete T
	INNER JOIN Messages M ON M.TopicId = T.TopicId
WHERE
	M.UserId = @UserId
ORDER BY T.TopicId desc, M.MessageId desc
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetUnanswered]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsGetUnanswered]
(
	@StartIndex int = 0
	,@Length int = 10
)
AS

SELECT *
FROM
	(SELECT
		ROW_NUMBER() OVER (ORDER BY T.TopicId) AS RowNumber
		,T.TopicId
		,T.TopicTitle
		,T.TopicShortName
		,T.TopicDescription
		,T.TopicCreationDate
		,T.TopicViews
		,T.TopicReplies
		,T.UserId
		,T.TopicTags
		,T.TopicIsClose
		,T.TopicOrder
		,T.LastMessageId
		,U.UserName
		,T.ForumId
		,F.ForumName
		,F.ForumShortName
	FROM
	Topics T    
		INNER JOIN AspNetUsers U ON U.Id = T.UserId    
		INNER JOIN Forums F ON F.ForumId = T.ForumId    
	WHERE    
		T.Active = 1    
		AND    
		F.Active = 1  
		AND
		T.TopicReplies = 0 -- Unanswered
		AND
		T.TopicOrder IS NULL -- Not sticky	
	) T
WHERE
	RowNumber BETWEEN @StartIndex+1 AND @StartIndex + @Length
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsGetUnansweredCount]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
Create procedure [dbo].[SPTopicsGetUnansweredCount]
As
Begin

	Select Count(*) as [Count]
	FROM
		TopicsComplete T with (nolock)
	WHERE
		T.TopicReplies = 0 -- Unanswered
		AND
		T.TopicOrder IS NULL -- Not sticky	
End
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsInsert]
(
	@TopicTitle nvarchar(255)
	,@TopicShortName nvarchar(64)
	,@TopicDescription nvarchar(max)
	,@UserId uniqueidentifier
	,@TopicTags nvarchar(256)
	,@TopicOrder int
	,@Forum nvarchar(32)
	,@Ip varchar (39)
	,@ReadAccessGroupId smallint
	,@PostAccessGroupId smallint
	,@TopicId int OUTPUT
)
AS
/*
- Inserts topic
- Insert tags
- Updates recount on father
*/

DECLARE @ForumId int

SELECT @ForumId = ForumId FROM Forums WHERE ForumShortName = @Forum
SET @TopicTags = LOWER(@TopicTags)

IF @TopicOrder IS NOT NULL
	BEGIN
	SELECT @TopicOrder = MAX(TopicOrder)+1 FROM Topics
	SELECT @TopicOrder = ISNULL(@TopicOrder, 1)
	END

BEGIN TRY
	BEGIN TRANSACTION
	
	INSERT INTO dbo.Topics
	(
	TopicTitle
	,TopicShortName
	,TopicDescription
	,TopicCreationDate
	,TopicLastEditDate
	,TopicViews
	,TopicReplies
	,UserId
	,TopicTags
	,ForumId
	,TopicLastEditUser
	,TopicLastEditIp
	,Active
	,TopicIsClose
	,TopicOrder
	,MessagesIdentity
	,ReadAccessGroupId
	,PostAccessGroupId
	)
	VALUES
	(
	@TopicTitle
	,@TopicShortName
	,@TopicDescription
	,GETUTCDATE()
	,GETUTCDATE()
	,0--TopicViews
	,0--TopicReplies
	,@UserId
	,@TopicTags
	,@ForumId
	,@UserId
	,@Ip
	,1--Active
	,0--TopicIsClose
	,@TopicOrder
	,0--MessageIdentity
	,@ReadAccessGroupId
	,@PostAccessGroupId
	);

	SELECT @TopicId = @@IDENTITY;

	--Add tags
	exec dbo.SPTagsInsert @Tags=@TopicTags, @TopicId=@TopicId;

	--Recount
	exec dbo.SPForumsUpdateRecount @ForumId=@ForumId;
	COMMIT
END TRY
BEGIN CATCH
	IF @@TRANCOUNT > 0
		ROLLBACK

  -- Raise an error with the details of the exception
	DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int
	SELECT @ErrMsg = ERROR_MESSAGE(),
		 @ErrSeverity = ERROR_SEVERITY()

	RAISERROR(@ErrMsg, @ErrSeverity, 1)

END CATCH
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsMove]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsMove]
	@TopicId int
	,@ForumId int
	,@UserId uniqueidentifier
	,@Ip varchar (39)
AS
DECLARE @PreviousForumId int
SELECT @PreviousForumId = ForumId FROM Topics WHERE TopicId = @TopicId
BEGIN TRY
	BEGIN TRANSACTION
	
	UPDATE Topics
	SET
		ForumId = @ForumId
		,TopicLastEditDate = GETUTCDATE()
		,TopicLastEditUser = @UserId
		,TopicLastEditIp = @Ip
	WHERE
		TopicId = @TopicId

	exec SPForumsUpdateRecount @ForumId
	exec SPForumsUpdateRecount @PreviousForumId

	COMMIT
END TRY
BEGIN CATCH
	IF @@TRANCOUNT > 0
		ROLLBACK

  -- Raise an error with the details of the exception
	DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int
	SELECT @ErrMsg = ERROR_MESSAGE(),
		 @ErrSeverity = ERROR_SEVERITY()

	RAISERROR(@ErrMsg, @ErrSeverity, 1)

END CATCH
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsOpen]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsOpen]
	@TopicId int
	,@UserId uniqueidentifier
	,@Ip varchar (39)
AS
	UPDATE Topics
	SET
		TopicIsClose = 0
		,TopicLastEditDate = GETUTCDATE()
		,TopicLastEditUser = @UserId
		,TopicLastEditIp = @Ip
	WHERE
		TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsSubscriptionsDelete]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsSubscriptionsDelete]
	@TopicId int
	,@UserId uniqueidentifier
	,@Userguid char(32)
AS
DELETE S
FROM 
	TopicsSubscriptions S
WHERE
	S.TopicId = @TopicId
	AND
	S.UserId = @UserId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsSubscriptionsGetByTopic]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsSubscriptionsGetByTopic]
	@TopicId int
AS
/*
	Gets the active users subscribed to a topic.
	Checks read access of topic vs user role
*/
SELECT
	U.Id as "UserId"
	,U.UserName
	,U.Email as "UserEmail"
	,NULL as "UserEmailPolicy"
	,U.Id as "UserGuid"
FROM
	TopicsSubscriptions S
	INNER JOIN Topics T ON T.TopicId = S.TopicId
	INNER JOIN AspNetUsers U ON U.Id = S.UserId
WHERE
	S.TopicId = @TopicId
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsSubscriptionsGetByUser]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsSubscriptionsGetByUser]
	@UserId uniqueidentifier
AS
SELECT
	T.TopicId
	,T.TopicTitle
	,T.TopicShortName
	,T.ForumId
	,T.ForumName
	,T.ForumShortName
FROM
	TopicsSubscriptions S
	INNER JOIN TopicsComplete T ON T.TopicId = S.TopicId
WHERE
	S.UserId = @UserId
ORDER BY
	S.TopicId DESC
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsSubscriptionsInsert]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsSubscriptionsInsert]
	@TopicId int
	,@UserId uniqueidentifier
AS
IF NOT EXISTS (SELECT TopicId FROM TopicsSubscriptions WHERE TopicId = @TopicId AND UserID = @UserId)
BEGIN
	INSERT INTO TopicsSubscriptions
	(TopicId, UserId)
	VALUES
	(@TopicId, @UserId)
END
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsUpdate]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsUpdate]
	@TopicId int
	,@TopicTitle nvarchar(256)
	,@TopicDescription nvarchar(max)
	,@UserId uniqueidentifier
	,@TopicTags nvarchar(256)
	,@TopicOrder int
	,@ReadAccessGroupId smallint
	,@PostAccessGroupId smallint
	,@Ip varchar (39)
AS
DECLARE @PreviousTags nvarchar(256)
SELECT @PreviousTags=TopicTags FROM Topics WHERE TopicId=@TopicId

IF @TopicOrder IS NOT NULL
	BEGIN
	SELECT @TopicOrder = MAX(TopicOrder)+1 FROM Topics
	SELECT @TopicOrder = ISNULL(@TopicOrder, 1)
	END

BEGIN TRY
	BEGIN TRANSACTION

	UPDATE T
	SET
		TopicTitle = @TopicTitle
		,TopicDescription = @TopicDescription
		,TopicLastEditDate = GETUTCDATE()
		,TopicTags = @TopicTags
		,TopicLastEditUser = @UserId
		,TopicLastEditIp = @Ip
		,TopicOrder = @TopicOrder
		,ReadAccessGroupId = @ReadAccessGroupId
		,PostAccessGroupId = @PostAccessGroupId
	FROM
		Topics T
	WHERE
		TopicId = @TopicId

	--Edit tags
	EXEC dbo.[SPTagsInsert] @Tags=@TopicTags, @TopicId=@TopicId, @PreviousTags=@PreviousTags

	COMMIT
END TRY
BEGIN CATCH
	IF @@TRANCOUNT > 0
		ROLLBACK

  -- Raise an error with the details of the exception
	DECLARE @ErrMsg nvarchar(4000), @ErrSeverity int
	SELECT @ErrMsg = ERROR_MESSAGE(),
		 @ErrSeverity = ERROR_SEVERITY()

	RAISERROR(@ErrMsg, @ErrSeverity, 1)
END CATCH
GO
/****** Object:  StoredProcedure [dbo].[SPTopicsUpdateLastMessage]    Script Date: 11/13/2014 1:35:16 PM ******/

SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SPTopicsUpdateLastMessage]
	@TopicId int
	,@MessageId int
AS

UPDATE Topics
SET
	TopicReplies = TopicReplies + 1
	,LastMessageId = @MessageId
WHERE
	TopicId = @TopicId
GO
